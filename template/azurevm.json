{
    "$schema":  "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymenttemplate.json#",
    "contentversion":  "1.0.0.0",
    "parameters":  {
                       "location":  {
                                        "type":  "string",
                                        "defaultvalue":  "chinaeast2"
                                    },
                       "workspacename":  {
                                             "type":  "string"
                                         },
                       "security - ASC-ComplianceandProtection_id":  {
                                                                         "defaultValue":  "[newGuid()]",
                                                                         "type":  "string"
                                                                     },
                       "security - EventAnalyzer_id":  {
                                                           "defaultValue":  "[newGuid()]",
                                                           "type":  "string"
                                                       },
                       "security - IdentityAndAccess_id":  {
                                                               "defaultValue":  "[newGuid()]",
                                                               "type":  "string"
                                                           },
                       "security - LinuxMachines_id":  {
                                                           "defaultValue":  "[newGuid()]",
                                                           "type":  "string"
                                                       },
                       "security - InsecureProtocols_id":  {
                                                               "defaultValue":  "[newGuid()]",
                                                               "type":  "string"
                                                           },
                       "security - linuxwindows_id":  {
                                                          "defaultValue":  "[newGuid()]",
                                                          "type":  "string"
                                                      }
                   },
    "resources":  [
                      {
                          "name":  "[parameters('security - ASC-ComplianceandProtection_id')]",
                          "properties":  {
                                             "displayName":  "security - Compliance and Protection Status",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"id\": \"fda9132a-a0f0-41a5-93aa-3175ef6af042\",             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"General\",             \"subTarget\": \"General\",             \"style\": \"link\"           },           {             \"id\": \"6edfd262-86d3-460e-969e-ca86fbce5e47\",             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Alerts and Incidents\",             \"subTarget\": \"Alerts\",             \"style\": \"link\"           },           {             \"id\": \"eca75291-bcda-4b4a-9326-8d4d01fea325\",             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Compliance and Posture\",             \"subTarget\": \"Compliance\",             \"style\": \"link\"           },           {             \"id\": \"d3b14d0b-a1d6-4435-9642-f61c52c46417\",             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Endpoint Updates and Protection\",             \"subTarget\": \"EP\",             \"style\": \"link\"           },           {             \"id\": \"97426d19-7644-44cb-98f3-61716422531e\",             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Assessments\",             \"subTarget\": \"Assessments\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 9\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::selected\"         ],         \"parameters\": [           {             \"id\": \"3218e2b0-1bcc-46d4-affa-d298e0cf90f6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultSubscription_Internal\",             \"type\": 1,             \"isRequired\": true,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"isHiddenWhenLocked\": true,             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"e6ded9a1-a83c-4762-938d-5bf8ff3d3d38\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscription\",             \"type\": 6,             \"isRequired\": true,             \"query\": \"summarize by subscriptionId\\r\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"customWidth\": \"33\",       \"name\": \"parameters - 10\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"6d2d5f84-767c-4d51-82d5-6981e96bacdc\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspace\",             \"type\": 5,             \"query\": \"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| order by name asc\\r\\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\\r\\n| mvexpand All limit 100\\r\\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"befbf593-c171-4129-b890-7e642265ed0c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 1209600000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ]             }           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"customWidth\": \"50\",       \"name\": \"parameters - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"search *\\r\\n| summarize count() by Type\\r\\n| render barchart\",         \"size\": 0,         \"timeContext\": {           \"durationMs\": 1209600000         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspace}\"         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"General\"       },       \"name\": \"General\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert \\r\\n| summarize AlertCount = count() by AlertSeverity\",               \"size\": 1,               \"title\": \"Alerts by Severity\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert \\r\\n| summarize AlertCount = count() by ProviderName, IsIncident\",               \"size\": 1,               \"title\": \"Alerts by Provider\",               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 9\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"parameters\": [                 {                   \"id\": \"43415fb7-83e4-4b71-9e69-59c3acb598e3\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"ProductSelection\",                   \"type\": 5,                   \"isRequired\": true,                   \"multiSelect\": true,                   \"quote\": \"'\",                   \"delimiter\": \",\",                   \"query\": \"SecurityAlert \\r\\n| where isnotempty(ProductName)\\r\\n| summarize count() by  ProductName\\r\\n| order by count_ desc\",                   \"crossComponentResources\": [                     \"{Workspace}\"                   ],                   \"value\": [                     \"value::all\"                   ],                   \"typeSettings\": {                     \"additionalResourceOptions\": [                       \"value::all\"                     ]                   },                   \"timeContext\": {                     \"durationMs\": 0                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 0,                   \"resourceType\": \"microsoft.operationalinsights/workspaces\"                 },                 {                   \"id\": \"903503cc-f549-4d2c-bd6e-adebb0d91799\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"SeveritySelect\",                   \"type\": 2,                   \"isRequired\": true,                   \"multiSelect\": true,                   \"quote\": \"'\",                   \"delimiter\": \",\",                   \"query\": \"SecurityAlert \\r\\n| where isnotempty(AlertSeverity)\\r\\n| summarize by AlertSeverity\",                   \"crossComponentResources\": [                     \"{Workspace}\"                   ],                   \"value\": [                     \"value::all\"                   ],                   \"typeSettings\": {                     \"additionalResourceOptions\": [                       \"value::all\"                     ]                   },                   \"timeContext\": {                     \"durationMs\": 0                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 0,                   \"resourceType\": \"microsoft.operationalinsights/workspaces\"                 }               ],               \"style\": \"above\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\"             },             \"customWidth\": \"30\",             \"name\": \"parameters - 10\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert\\r\\n| where ProductName in ( {ProductSelection} )\\r\\n| where AlertSeverity in ({SeveritySelect})\\r\\n| extend HostName = tostring(parse_json(Entities)[0].HostName) \\r\\n| summarize AlertCount = count() by AlertSeverity, VendorName, ProductName, SystemAlertId, ResourceId, AlertType, StartTime, EndTime, RemediationSteps\",               \"size\": 0,               \"title\": \"Alert Details for {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"AlertSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 11\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert\\r\\n| make-series count() default=0 on StartTime from {TimeRange:start} to {TimeRange:end} step 1d by ProductName\",               \"size\": 0,               \"title\": \"Alert Count by Product Over '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"timechart\"             },             \"name\": \"query - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityAlert\\r\\n| project TimeGenerated, DisplayName, AlertSeverity, ProductName, ResourceId, Entities, RemediationSteps\\r\\n| sort by TimeGenerated\",               \"size\": 0,               \"title\": \"Alerts Between '{TimeBrush:label}'\",               \"timeContext\": {                 \"durationMs\": 86400000               },               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"AlertSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\"                   },                   {                     \"columnId\": \"DisplayName\",                     \"label\": \"Alert Name\"                   },                   {                     \"columnId\": \"AlertSeverity\",                     \"label\": \"Severity\"                   },                   {                     \"columnId\": \"ProductName\",                     \"label\": \"Product\"                   },                   {                     \"columnId\": \"ResourceId\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"Entities\"                   },                   {                     \"columnId\": \"RemediationSteps\",                     \"label\": \"Remediation Steps\"                   }                 ]               }             },             \"name\": \"query - 5\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Alerts\"       },       \"name\": \"Alerts\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n //| where * contains \\\"Remediate vulnerabilities\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments\\\"\\r\\n\\t | extend assessmentKey = substring(properties.links.azurePortal,indexof(properties.links.azurePortal,\\\"assessmentKey/\\\")+14,36)\\r\\n ) on assessmentKey\\r\\n| parse id with * \\\"/virtualMachines/\\\" vmname \\\"/providers\\\" * \\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId, vmname\\r\\n| extend resourceSource = properties.resourceDetails.Source\\r\\n| extend strCompName = iff(resourceSource==\\\"Azure\\\",vmname,properties.resourceDetails.MachineName)\\r\\n| extend severity = properties.metadata.severity,\\r\\n         category = properties.metadata.categories[0],\\r\\n         description = properties.metadata.description,\\r\\n         displayName = properties.metadata.displayName,\\r\\n\\t\\t resourceId = iff(resourceSource==\\\"Azure\\\",properties.resourceDetails.Id,properties.resourceDetails.WorkspaceId),\\r\\n         code = properties.status.code,\\r\\n         timeGenerated = properties.additionalData.[\\\"Last scan time\\\"],\\r\\n\\t\\t ostype = properties.additionalData.[\\\"OS Type\\\"],\\r\\n         impact = properties.metadata.userImpact,\\r\\n         additionalData = properties.additionalData,\\r\\n\\t\\t threat  = properties.metadata.threats      \\r\\n| summarize count() by  tostring(severity),tostring(category)\",               \"size\": 0,               \"title\": \"Severity\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n //| where * contains \\\"Remediate vulnerabilities\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments\\\"\\r\\n\\t | extend assessmentKey = substring(properties.links.azurePortal,indexof(properties.links.azurePortal,\\\"assessmentKey/\\\")+14,36)\\r\\n ) on assessmentKey\\r\\n| parse id with * \\\"/virtualMachines/\\\" vmname \\\"/providers\\\" * \\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId, vmname\\r\\n| extend resourceSource = properties.resourceDetails.Source\\r\\n| extend strCompName = iff(resourceSource==\\\"Azure\\\",vmname,properties.resourceDetails.MachineName)\\r\\n| extend severity = properties.metadata.severity,\\r\\n         category = properties.metadata.categories[0],\\r\\n         description = properties.metadata.description,\\r\\n         displayName = properties.metadata.displayName,\\r\\n\\t\\t resourceId = iff(resourceSource==\\\"Azure\\\",properties.resourceDetails.Id,properties.resourceDetails.WorkspaceId),\\r\\n         code = properties.status.code,\\r\\n         timeGenerated = properties.additionalData.[\\\"Last scan time\\\"],\\r\\n\\t\\t ostype = properties.additionalData.[\\\"OS Type\\\"],\\r\\n         impact = properties.metadata.userImpact,\\r\\n         additionalData = properties.additionalData,\\r\\n\\t\\t threat  = properties.metadata.threats\\r\\n| summarize count() by  tostring(category)\",               \"size\": 0,               \"title\": \"Category\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"visualization\": \"piechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 2\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"parameters\": [                 {                   \"id\": \"7f84ceda-dbeb-48da-b90e-e595824197cf\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"Severity\",                   \"label\": \"severity\",                   \"type\": 5,                   \"isRequired\": true,                   \"multiSelect\": true,                   \"quote\": \"'\",                   \"delimiter\": \",\",                   \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n //| where * contains \\\"Remediate vulnerabilities\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments\\\"\\r\\n | extend assessmentKey = substring(properties.links.azurePortal,indexof(properties.links.azurePortal,\\\"assessmentKey/\\\")+14,36)\\r\\n ) on assessmentKey\\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId\\r\\n| extend severity = tostring(properties.metadata.severity)\\r\\n| distinct severity\\r\\n| order by severity asc\\r\\n\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"value\": [                     \"Low\"                   ],                   \"typeSettings\": {                     \"additionalResourceOptions\": [],                     \"showDefault\": false                   },                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 }               ],               \"style\": \"above\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\"             },             \"name\": \"parameters - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n | where type == \\\"microsoft.security/assessments\\\"\\r\\n //| where * contains \\\"Remediate vulnerabilities\\\"\\r\\n | summarize by assessmentKey=name //the ID of the assessment\\r\\n | join kind=inner (\\r\\n    securityresources\\r\\n     | where type == \\\"microsoft.security/assessments\\\"\\r\\n\\t | extend assessmentKey = substring(properties.links.azurePortal,indexof(properties.links.azurePortal,\\\"assessmentKey/\\\")+14,36)\\r\\n ) on assessmentKey\\r\\n| parse id with * \\\"/virtualMachines/\\\" vmname \\\"/providers\\\" * \\r\\n| project assessmentKey, subassessmentKey=name, id, parse_json(properties), resourceGroup, subscriptionId, tenantId, vmname\\r\\n| extend resourceSource = properties.resourceDetails.Source\\r\\n| extend strCompName = iff(resourceSource==\\\"Azure\\\",vmname,properties.resourceDetails.MachineName)\\r\\n| extend severity = properties.metadata.severity,\\r\\n         category = properties.metadata.categories[0],\\r\\n         description = properties.metadata.description,\\r\\n         displayName = properties.metadata.displayName,\\r\\n\\t\\t resourceId = iff(resourceSource==\\\"Azure\\\",properties.resourceDetails.Id,properties.resourceDetails.WorkspaceId),\\r\\n         code = properties.status.code,\\r\\n         timeGenerated = properties.additionalData.[\\\"Last scan time\\\"],\\r\\n\\t\\t ostype = properties.additionalData.[\\\"OS Type\\\"],\\r\\n         impact = properties.metadata.userImpact,\\r\\n         additionalData = properties.additionalData,\\r\\n\\t\\t threat  = properties.metadata.threats\\r\\n| project severity, '{Severity:name}', strCompName, displayName, category, impact, ostype, threat\\r\\n| where severity in ({Severity})\\r\\n| summarize by Severity = tostring(severity), ['Computer Name']=strCompName, Description = tostring(displayName) , Category = tostring(category), tostring(impact), ['OS type']=tostring(ostype), ['User Impact']=tostring(impact)\\r\\n\\r\\n\",               \"size\": 0,               \"showExportToExcel\": true,               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Severity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Low\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"patchable\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"true\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"false\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 3\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Assessments\"       },       \"name\": \"Assessments\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards\\\"\\r\\n| extend \\r\\n\\tpassedControls = trim (' ', tostring(properties.passedControls)), \\r\\n\\tfailedControls = trim(' ',tostring(properties.failedControls)), \\r\\n\\tstate \\t\\t   = trim(' ', tostring(properties.state)), \\r\\n\\tunsupportedControls = trim(' ', tostring(properties.unsupportedControls)), \\r\\n\\tskippedControls     = trim(' ', tostring(properties.skippedControls))\\r\\n| project name, passedControls, failedControls, unsupportedControls, skippedControls , subscriptionId\\r\\n| order by passedControls desc\",               \"size\": 0,               \"title\": \"Current Compliance Details\",               \"showExportToExcel\": true,               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"passedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"hotCold\",                       \"showIcon\": true                     },                     \"numberFormat\": {                       \"unit\": 0,                       \"options\": {                         \"style\": \"decimal\",                         \"useGrouping\": false                       }                     }                   },                   {                     \"columnMatch\": \"failedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"unsupportedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"skippedControls\",                     \"formatter\": 3,                     \"formatOptions\": {                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 12\"           },           {             \"type\": 9,             \"content\": {               \"version\": \"KqlParameterItem/1.0\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"parameters\": [                 {                   \"id\": \"dd8f4188-2076-4696-ba56-8418a3fcc6f5\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"SelectCompliance\",                   \"type\": 5,                   \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards\\\"\\r\\n| project name\\r\\n\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"value\": \"ISO-27001\",                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 },                 {                   \"id\": \"bd9c3eae-84af-42b5-8c93-e281788948d7\",                   \"version\": \"KqlParameterItem/1.0\",                   \"name\": \"selectState\",                   \"type\": 5,                   \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\\\"\\r\\n | extend  state \\t\\t   = trim(' ', tostring(properties.state))\\r\\n| summarize by state\",                   \"crossComponentResources\": [                     \"{Subscription}\"                   ],                   \"value\": \"Failed\",                   \"typeSettings\": {                     \"additionalResourceOptions\": []                   },                   \"timeContext\": {                     \"durationMs\": 0                   },                   \"timeContextFromParameter\": \"TimeRange\",                   \"queryType\": 1,                   \"resourceType\": \"microsoft.resourcegraph/resources\"                 }               ],               \"style\": \"above\",               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\"             },             \"name\": \"parameters - 13\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"securityresources\\r\\n| where type == \\\"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\\\"\\r\\n| parse id with *\\\"/regulatoryComplianceStandards/\\\" strControlName \\\"/regulatory\\\"*\\r\\n | extend \\r\\n\\t state \\t\\t   = trim(' ', tostring(properties.state))\\r\\n\\t,description    = trim(' ', tostring(properties.description))\\r\\n| where  strControlName startswith '{SelectCompliance}'\\r\\n| extend isState = iif(isempty('{selectState}'),\\\"All states\\\",'{selectState}')\\r\\n//| where isSstate == '{selectState}'\\r\\n| summarize by  ControlName = strControlName, name, Status = isState, description\\r\\n\",               \"size\": 0,               \"showExportToExcel\": true,               \"queryType\": 1,               \"resourceType\": \"microsoft.resourcegraph/resources\",               \"crossComponentResources\": [                 \"{Subscription}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Status\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"failed\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Failed\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Passed\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Unsupported\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     },                     \"numberFormat\": {                       \"unit\": 0,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   }                 ],                 \"filter\": true               }             },             \"name\": \"query - 14\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityAlert\\r\\n| where ResourceId contains tostring(Resource_)\\r\\n| project TimeGenerated, Resource_, AlertName, AlertSeverity, ProductName\\r\\n| summarize arg_max(TimeGenerated, *) by TimeGenerated\\r\\n| project-away TimeGenerated1\",               \"size\": 0,               \"title\": \"Related Alerts to Resource in '{TimeBrush:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": \"Resource\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"AlertSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"High\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Medium\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"low\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"representation\": \"gray\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"ResourceId\",                     \"formatter\": 1,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource Impacted\"                   },                   {                     \"columnId\": \"AlertName\",                     \"label\": \"Alert Title\"                   },                   {                     \"columnId\": \"AlertSeverity\",                     \"label\": \"Severity\"                   },                   {                     \"columnId\": \"ProductName\",                     \"label\": \"Product\"                   }                 ]               },               \"sortBy\": [],               \"graphSettings\": {                 \"type\": 0               }             },             \"name\": \"query - 6\",             \"styleSettings\": {               \"showBorder\": true             }           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Compliance\"       },       \"name\": \"Compliance\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ProtectionStatus\\r\\n| extend Protection = iff(ThreatStatusRank == 150, \\\"Protected\\\", \\\"Security Event Should Be Addressed\\\")\\r\\n| extend Resource = Computer\\r\\n| project TimeGenerated, Resource, TypeofProtection, Protection, ThreatStatus ,ProtectionStatus, SignatureVersion\\r\\n| summarize arg_max(TimeGenerated,*) by Resource\\r\\n\",               \"size\": 1,               \"showAnalytics\": true,               \"title\": \"Endpoint Protection Status\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"sortBy\": [                   {                     \"itemKey\": \"ThreatStatus\",                     \"sortOrder\": 1                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"TypeofProtection\",                     \"label\": \"Endpoint Protection\"                   },                   {                     \"columnId\": \"Protection\",                     \"label\": \"Protection Status\"                   },                   {                     \"columnId\": \"ThreatStatus\",                     \"label\": \"Threat Status\"                   },                   {                     \"columnId\": \"ProtectionStatus\",                     \"label\": \"Protection Status\"                   },                   {                     \"columnId\": \"SignatureVersion\",                     \"label\": \"Signature Version\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"ThreatStatus\",                   \"sortOrder\": 1                 }               ]             },             \"name\": \"query - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nProtectionStatus\\r\\n| where ThreatStatusRank != 150\\r\\n| where Computer contains tostring(Resource_)\\r\\n| project TimeGenerated, Resource_, ThreatStatus, ProtectionStatus, Threat, ThreatStatusDetails\",               \"size\": 1,               \"title\": \"Threats Over Last '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"ThreatStatusDetails\",                     \"sortOrder\": 1                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"ThreatStatus\",                     \"label\": \"Action Taken\"                   },                   {                     \"columnId\": \"ProtectionStatus\",                     \"label\": \"Event Summary\"                   },                   {                     \"columnId\": \"Threat\",                     \"label\": \"Malicious Artifact\",                     \"comment\": \"File or Process\"                   },                   {                     \"columnId\": \"ThreatStatusDetails\",                     \"label\": \"Details\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"ThreatStatusDetails\",                   \"sortOrder\": 1                 }               ]             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"ProtectionStatus\\r\\n| where ProtectionStatusRank != 150\\r\\n| extend Protection = case( ProtectionStatusRank == 250, \\\"Signatures out of date\\\"\\r\\n                            , ProtectionStatusRank == 270, \\\"No real-time protction detected\\\"\\r\\n                            , ProtectionStatusRank == 470, \\\"No endpoint protection detected\\\"\\r\\n                            , ProtectionStatusRank == 550, \\\"Threat detected\\\"\\r\\n                            , \\\"No threats detected\\\"\\r\\n                            )\\r\\n| summarize count() by DeviceName, Protection\\r\\n| sort by count_ desc \",               \"size\": 0,               \"title\": \"Most Vulnerable Machines\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"DeviceName\",                     \"label\": \"Device\"                   },                   {                     \"columnId\": \"Protection\",                     \"label\": \"Endpoint Protection\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Trend Over Last 30 Days\"                   }                 ]               }             },             \"name\": \"query - 1\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityBaseline\\r\\n| where AnalyzeResult != 'Passed'\\r\\n| extend Resource = ResourceId\\r\\n| summarize count() by Resource\\r\\n| sort by count_ desc\",               \"size\": 0,               \"title\": \"Resources with Failed Baselines Within '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"Resource\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Number of Logs\"                   }                 ]               }             },             \"customWidth\": \"25\",             \"name\": \"query - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityBaseline\\r\\n| where AnalyzeResult != 'Passed'\\r\\n| where ResourceId contains tostring(Resource_)\\r\\n| project TimeGenerated, Description, BaselineType, CceId, RuleSeverity, Resource_, AnalyzeResult\",               \"size\": 0,               \"title\": \"Failed Security Baselines for Machine\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": null,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RuleSeverity\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Critical\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Warning\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Informational\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Description\"                   },                   {                     \"columnId\": \"BaselineType\",                     \"label\": \"OS\"                   },                   {                     \"columnId\": \"CceId\"                   },                   {                     \"columnId\": \"RuleSeverity\",                     \"label\": \"Severity\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"AnalyzeResult\",                     \"label\": \"Status\"                   }                 ]               }             },             \"customWidth\": \"75\",             \"name\": \"query - 1\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nSecurityBaselineSummary\\r\\n| project TimeGenerated, Resource_, OSName, TotalAssessedRules, PercentageOfPassedRules, CriticalFailedRules, WarningFailedRules, InformationalFailedRules\\r\\n| summarize arg_max(TimeGenerated, *)\",               \"size\": 4,               \"title\": \"Resource Security Baselines Summary\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Resource_\",                     \"formatter\": 13,                     \"formatOptions\": {                       \"linkTarget\": null,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"PercentageOfPassedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"90\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"80\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"90\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     },                     \"numberFormat\": {                       \"unit\": 1,                       \"options\": {                         \"style\": \"decimal\"                       }                     }                   },                   {                     \"columnMatch\": \"CriticalFailedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"5\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"5\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"WarningFailedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"10\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"10\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   },                   {                     \"columnMatch\": \"InformationalFailedRules\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"\u003c\",                           \"thresholdValue\": \"10\",                           \"representation\": \"green\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"\u003e\",                           \"thresholdValue\": \"10\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resource\"                   },                   {                     \"columnId\": \"OSName\",                     \"label\": \"OS\"                   },                   {                     \"columnId\": \"TotalAssessedRules\",                     \"label\": \"Total Assessed Rules\"                   },                   {                     \"columnId\": \"PercentageOfPassedRules\",                     \"label\": \"Percent Passed\"                   },                   {                     \"columnId\": \"CriticalFailedRules\",                     \"label\": \"Critical Failed\"                   },                   {                     \"columnId\": \"WarningFailedRules\",                     \"label\": \"Warning Failed\"                   },                   {                     \"columnId\": \"InformationalFailedRules\",                     \"label\": \"Informational Failed\"                   }                 ]               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Update\\r\\n| where UpdateState != 'Installed'\\r\\n| extend Resource = Computer\\r\\n| summarize count() by Resource\\r\\n| sort by count_ desc\",               \"size\": 0,               \"title\": \"Resources with Updates within '{TimeRange:label}'\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportMultipleValues\": true,               \"exportedParameters\": [                 {                   \"fieldName\": \"Resource\",                   \"parameterName\": \"Resource\",                   \"parameterType\": 1,                   \"delimiter\": \"\"                 }               ],               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"Resource\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"Resource\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Number of Logs\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Resource\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"25\",             \"name\": \"query - 8\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let Resource_ = dynamic({Resource});\\r\\nUpdate\\r\\n| where UpdateState != 'Installed'\\r\\n| where Computer contains tostring(Resource_)\\r\\n| project TimeGenerated, Product, Classification, Title, KBID, Resource_, UpdateState\\r\\n\",               \"size\": 0,               \"title\": \"Updates Needed for Resource\",               \"timeContext\": {                 \"durationMs\": 1209600000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Classification\",                     \"formatter\": 18,                     \"formatOptions\": {                       \"showIcon\": true,                       \"thresholdsOptions\": \"colors\",                       \"thresholdsGrid\": [                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Updates\",                           \"representation\": \"orange\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Feature Packs\",                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Definition Packs\",                           \"representation\": \"yellow\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"contains\",                           \"thresholdValue\": \"Security\",                           \"representation\": \"redBright\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"==\",                           \"thresholdValue\": \"Others\",                           \"representation\": \"gray\",                           \"text\": \"{0}{1}\"                         },                         {                           \"operator\": \"Default\",                           \"thresholdValue\": null,                           \"representation\": \"blue\",                           \"text\": \"{0}{1}\"                         }                       ]                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TimeGenerated\",                     \"label\": \"Time Generated\"                   },                   {                     \"columnId\": \"Product\"                   },                   {                     \"columnId\": \"Classification\"                   },                   {                     \"columnId\": \"Resource_\",                     \"label\": \"Resouce\"                   },                   {                     \"columnId\": \"UpdateState\",                     \"label\": \"Update Status\"                   }                 ]               }             },             \"customWidth\": \"75\",             \"name\": \"query - 9\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"EP\"       },       \"name\": \"Endpoint\"     }   ],   \"fallbackResourceIds\": [     \"/subscriptions/0f2daa80-6b16-44ee-8016-4ad888e059ac/resourceGroups/omsdemo/providers/Microsoft.OperationalInsights/workspaces/somscndemo\"   ],   \"fromTemplateId\": \"ASC-ComplianceandProtection\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('security - EventAnalyzer_id')]",
                          "properties":  {
                                             "displayName":  "security - Event Analyzer on Windows VM",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Event Analyzer\\n---\\n\\nEvent Analyzer is a visualizing workbook to explore and audit Windows Event Log and explore all events details and attributes for viewing, analyzing and monitoring events recorded in Microsoft Windows event logs. The analyzer speeds up the analysis of event logs (security, application, system, setup, directory service, DNS and others).\"       },       \"name\": \"text - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::all\"         ],         \"parameters\": [           {             \"id\": \"6bdfb4ab-a58b-4035-bfca-4b4bdb67aa60\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultWorkspace\",             \"type\": 5,             \"isRequired\": true,             \"value\": \"/subscriptions/\u003csubs_ID\u003e/resourcegroups/\u003crg_name\u003e/providers/microsoft.operationalinsights/workspaces/\u003cworkspace_name\u003e\",             \"isHiddenWhenLocked\": true,             \"typeSettings\": {               \"resourceTypeFilter\": {                 \"microsoft.operationalinsights/workspaces\": true               },               \"additionalResourceOptions\": []             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"resourceType\": \"microsoft.insights/components\"           },           {             \"id\": \"66c96524-06de-4fb2-be22-3314ff7f96b0\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"ContextFree\",             \"type\": 1,             \"query\": \"{\\\"version\\\":\\\"1.0.0\\\",\\\"content\\\":\\\"\\\\\\\"{DefaultWorkspace}\\\\\\\"\\\",\\\"transformers\\\":null}\",             \"isHiddenWhenLocked\": true,             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 8           },           {             \"id\": \"9ecea5c4-8730-4503-a052-95a2418ddd70\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Selection\",             \"type\": 1,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend match = strcat(\\\"'\\\", id, \\\"'\\\") =~ \\\"{DefaultWorkspace:value}\\\"\\r\\n| order by match desc, name asc\\r\\n| take 1\\r\\n| project value = tostring(pack('sub', subscriptionId, 'rg', resourceGroup, 'ws', id))\",             \"crossComponentResources\": [               \"value::all\"             ],             \"isHiddenWhenLocked\": true,             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"above\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"conditionalVisibility\": {         \"parameterName\": \"_\",         \"comparison\": \"isEqualTo\",         \"value\": \"_\"       },       \"name\": \"parameters - 3\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"{Subscriptions}\"         ],         \"parameters\": [           {             \"id\": \"401c9381-d3bc-4594-be03-c322c0c6a135\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscriptions\",             \"type\": 6,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"summarize by subscriptionId\\r\\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ todynamic('{Selection}').sub, true, false)\",             \"crossComponentResources\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ]             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"8f5a2b0e-71bf-49f4-b570-c3d84c7cc7f6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 7,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\\r\\n| project id, selected = iff(id =~ todynamic('{Selection}').ws, true, false)\",             \"crossComponentResources\": [               \"{Subscriptions}\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"*\"             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"bcb5eb6b-b6a8-47c4-95a2-87753cb10ea8\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"value\": {               \"durationMs\": 86400000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ]             },             \"resourceType\": \"microsoft.insights/components\"           },           {             \"id\": \"1c1b8f51-b434-468a-b256-29826c15d9e1\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TestConnectivity\",             \"type\": 1,             \"query\": \"InsightsMetrics\\r\\n| where TimeGenerated {TimeRange}\\r\\n| take 1\",             \"isHiddenWhenLocked\": true,             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 2\"     },     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit File Share\",             \"subTarget\": \"1\",             \"preText\": \"\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit File System\",             \"subTarget\": \"2\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Filtering Platform Connection\",             \"subTarget\": \"3\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Handle Manipulation\",             \"subTarget\": \"4\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Kernel Object\",             \"subTarget\": \"5\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Other Object Access Events\",             \"subTarget\": \"6\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Registry\",             \"subTarget\": \"7\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Removable Storage\",             \"subTarget\": \"8\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit SAM\",             \"subTarget\": \"9\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Policy Change\",             \"subTarget\": \"10\",             \"style\": \"link\"           },           {             \"cellValue\": \"Tab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Audit Sensitive Privilege Use\",             \"subTarget\": \"11\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 4\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A network share object was accessed\\r\\n- A network share object was added\\r\\n- A network share object was modified\\r\\n- A network share object was deleted\\r\\n- SPN check for SMB/SMB2 failed\"             },             \"name\": \"text - 1\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5140, 5142, 5143, 5144, 5168)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\",               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"Account\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"Task\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Account\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"Task\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               },               \"chartSettings\": {                 \"xAxis\": \"TimeGenerated\",                 \"yAxis\": [                   \"EventID\"                 ],                 \"showLegend\": true,                 \"xSettings\": {},                 \"ySettings\": {}               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5140, 5142, 5143, 5144, 5168)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 86400000               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"table\",               \"gridSettings\": {                 \"filter\": true               }             },             \"showPin\": false,             \"name\": \"query - 0\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"1\"       },       \"name\": \"AuditFileShare\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:  \\r\\n- A handle to an object was requested \\r\\n- The handle to an object was closed \\r\\n- An object was deleted- An attempt was made to access an object\\r\\n- An attempt was made to create a hard link- The state of a transaction has changed \\r\\n- A file was virtualized\\r\\n- Permissions on an object were changed\"             },             \"name\": \"text - 1\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663, 4664, 4985, 5051, 4670)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\",               \"chartSettings\": {                 \"showLegend\": true,                 \"xSettings\": {},                 \"ySettings\": {}               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663, 4664, 4985, 5051, 4670)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 86400000               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 0\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"2\"       },       \"name\": \"AuditFileSystem\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n - The handle to an object was closed\\r\\n - An attempt was made to duplicate a handle to an object\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4658, 4690)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4658, 4690)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"4\"       },       \"name\": \"AuditHandleManipulation\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- The Windows Firewall Service blocked an application from accepting incoming connections on the network\\r\\n- The Windows Filtering Platform blocked a packet\\r\\n- A more restrictive Windows Filtering Platform filter has blocked a packet\\r\\n- The Windows Filtering Platform has permitted an application or service to listen on a port for incoming connections\\r\\n- The Windows Filtering Platform has blocked an application or service from listening on a port for incoming connections\\r\\n- The Windows Filtering Platform has permitted a connection\\r\\n- The Windows Filtering Platform has blocked a connection\\r\\n- The Windows Filtering Platform has permitted a bind to a local port\\r\\n- The Windows Filtering Platform has blocked a bind to a local port\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5031, 5150, 5151, 5154, 5155, 5156, 5157, 5158, 5159)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (5031, 5150, 5151, 5154, 5155, 5156, 5157, 5158, 5159)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity\",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"3\"       },       \"name\": \"AuditFilterPlatformConnection\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A handle to an object was requested\\r\\n- The handle to an object was closed\\r\\n- An object was deleted\\r\\n- An attempt was made to access an object\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4660, 4663)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"5\"       },       \"name\": \"AuditKernelObject\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n-  An application attempted to access a blocked ordinal through the TBS\\r\\n- Indirect access to an object was requested\\r\\n- The Windows Filtering Platform has detected a DoS attack and entered a defensive mode; packets associated with this attack will be discarded\\r\\n- The DoS attack has subsided and normal processing is being resumed\\r\\n- A scheduled task was created\\r\\n- A scheduled task was deleted\\r\\n- A scheduled task was enabled\\r\\n- A scheduled task was disabled\\r\\n- A scheduled task was updated\\r\\n- An object in the COM+ Catalog was modified\\r\\n- An object was deleted from the COM+ Catalog\\r\\n- An object was added to the COM+ Catalog\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4671, 4691, 5148, 5149, 4698, 4699, 4700, 4701, 4702, 5888, 5889, 5890)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TImeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\",               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"Account\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"EventID\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4671, 4691, 5148, 5149, 4698, 4699, 4700, 4701, 4702, 5888, 5889, 5890)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TImeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"6\"       },       \"name\": \"AuditOtherObject\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- An attempt was made to access an object\\r\\n- A handle to an object was requested\\r\\n- The handle to an object was closed\\r\\n- An object was deleted\\r\\n- A registry value was modified\\r\\n- A registry key was virtualized\\r\\n- Permissions on an object were changed\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4663, 4656, 4658, 4660, 4657, 5039, 4670)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4663, 4656, 4658, 4660, 4657, 5039, 4670)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"7\"       },       \"name\": \"AuditRegistry\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A handle to an object was requested\\r\\n- The handle to an object was closed\\r\\n- An attempt was made to access an object\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4663)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 4,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4656, 4658, 4663)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"8\"       },       \"name\": \"AuditRemovable\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A handle to an object was requested\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4661\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4661\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"9\"       },       \"name\": \"AuditSAM\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- The audit policy (SACL) on an object was changed\\r\\n- System audit policy was changed\\r\\n- Auditing settings on object were changed\\r\\n- The Per-user audit policy table was created\\r\\n- The CrashOnAuditFail value has changed\\r\\n- Auditing settings on object were changed\\r\\n- Special Groups Logon table modified\\r\\n- Per User Audit Policy was changed\\r\\n- An attempt was made to register a security event source\\r\\n- An attempt was made to unregister a security event source\"             },             \"name\": \"text - 0\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4715, 4719, 4817, 4902, 4906, 4907, 4908, 4912, 4904, 4905)\\r\\n| project TimeGenerated, Account , AccountType , Computer , EventSourceName , Channel , Task , EventData , EventID , Activity \\r\\n| top 1000 by TimeGenerated desc\",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4715, 4719, 4817, 4902, 4906, 4907, 4908, 4912, 4904, 4905)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 0,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"10\"       },       \"name\": \"AuditPolicyChange\",       \"styleSettings\": {         \"showBorder\": true       }     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"loadType\": \"always\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"Events:\\r\\n- A privileged service was called\\r\\n- An operation was attempted on a privileged object\\r\\n-  The state of a transaction has changed\"             },             \"name\": \"text - 0\",             \"styleSettings\": {               \"showBorder\": true             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4673, 4674, 4985)\\r\\n| project TimeGenerated, Account , Computer , EventData , EventID , Activity \",               \"size\": 1,               \"showAnnotations\": true,               \"timeContext\": {                 \"durationMs\": 2592000000               },               \"timeBrushParameterName\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"name\": \"query - 2\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID in (4673, 4674, 4985)\\r\\n| project Account , Computer , EventData , EventID , Activity \",               \"size\": 1,               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"filter\": true               }             },             \"name\": \"query - 1\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"Tab\",         \"comparison\": \"isEqualTo\",         \"value\": \"11\"       },       \"name\": \"AuditSensitive\",       \"styleSettings\": {         \"showBorder\": true       }     }   ],   \"styleSettings\": {     \"progressStyle\": \"loader\"   },   \"fromTemplateId\": \"sentinel-EventAnalyzerWorkbook\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('security - IdentityAndAccess_id')]",
                          "properties":  {
                                             "displayName":  "security - Identity And Access Analyzer on Windows VM",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"\"       },       \"name\": \"text - 1\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"80e332f7-8176-461f-b27a-0a52242fe6c9\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 86400000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"5a93ede8-361d-4cc6-93f8-967dfc355143\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Activity\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"SecurityEvent\\r\\n| summarize Count = count() by Activity\\r\\n| order by Count desc, Activity asc\\r\\n| project Value = Activity, Label = strcat(Activity, ' - ', Count)\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SecurityEvent\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity});\\r\\ndata\\r\\n| summarize Count = count() by Activity\\r\\n| join kind = fullouter (datatable(Activity:string)['Medium', 'high', 'low']) on Activity\\r\\n| project Activity = iff(Activity == '', Activity1, Activity), Count = iff(Activity == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Activity)\\r\\n on Activity\\r\\n| project-away Activity1, TimeGenerated\\r\\n| extend Activitys = Activity\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Activity = 'All', Activitys = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\",         \"size\": 4,         \"exportFieldName\": \"Activity\",         \"exportParameterName\": \"ActivityPiker\",         \"exportDefaultValue\": \"All\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Top 10 activities - click to filter by activity\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"Activity\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"Count\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           },           \"secondaryContent\": {             \"columnMatch\": \"Trend\",             \"formatter\": 9,             \"formatOptions\": {               \"palette\": \"lightBlue\",               \"showIcon\": true             }           },           \"showBorder\": false         }       },       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let data = SecurityEvent\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity})\\r\\n| where Activity == '{ActivityPiker}' or '{ActivityPiker}' == \\\"All\\\" and AccountType == 'User'\\r\\n| extend Name = extract(@'^(.*\\\\\\\\)?([^@]*)(@.*)?$', 2, tolower(Account));\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by Name\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Name\\r\\n    | project-away TimeGenerated) on Name\\r\\n| order by TotalCount desc, Name asc\\r\\n| project Name, TotalCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by Activity , Name\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Name, Activity\\r\\n    | project-away TimeGenerated) on Name, Activity\\r\\n| order by TotalCount desc, Name asc\\r\\n| project Name, Activity, TotalCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on Name\\r\\n| project Id, Name = Activity, Type = 'Activity', ['Activity Count'] = TotalCount, Trend, ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = Name, Type = 'Computer', ['Activity Count'] = TotalCount, Trend )\\r\\n| order by ['Activity Count'] desc, Name asc\",         \"size\": 0,         \"exportParameterName\": \"Userinfo\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"User activities\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Activity Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blueGreen\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"palette\": \"greenDark\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"IpAddress\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ParentId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Account\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Names Count\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"ParentId\",             \"treeType\": 0,             \"expanderColumn\": \"Name\"           },           \"labelSettings\": []         }       },       \"customWidth\": \"50\",       \"name\": \"query - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"//let Users = dynamic({Userinfo});\\r\\nlet data = SecurityEvent\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity})\\r\\n| where Activity == '{ActivityPiker}' or '{ActivityPiker}' == \\\"All\\\" and AccountType == 'Machine'\\r\\n| extend user = extract(@'^(.*\\\\\\\\)?([^@]*)(@.*)?$', 2, tolower(Account))\\r\\n| where dynamic({Userinfo}).Type == '*' or (dynamic({Userinfo}).Type == 'Computer' and user == dynamic({Userinfo}).Name);\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by Computer\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\\r\\n    | project-away TimeGenerated) on Computer\\r\\n| order by TotalCount desc, Computer asc\\r\\n| project Computer, TotalCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by Activity , Computer\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer, Activity\\r\\n    | project-away TimeGenerated) on Computer, Activity\\r\\n| order by TotalCount desc, Computer asc\\r\\n| project Computer, Activity, TotalCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on Computer\\r\\n| project Id, Name = Activity, Type = 'Activity', ['Activity Count'] = TotalCount, Trend, ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = Computer, Type = 'Computer', ['Activity Count'] = TotalCount, Trend )\\r\\n| order by ['Activity Count'] desc, Name asc\",         \"size\": 0,         \"exportFieldName\": \"\",         \"exportParameterName\": \"MachineInfo\",         \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Machine activities\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Id\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Type\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Activity Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"blue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Trend\",               \"formatter\": 9,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ParentId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"hierarchySettings\": {             \"idColumn\": \"Id\",             \"parentColumn\": \"ParentId\",             \"treeType\": 0,             \"expanderColumn\": \"Name\"           },           \"labelSettings\": []         }       },       \"customWidth\": \"50\",       \"name\": \"query - 4\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let Users = dynamic({Userinfo});\\r\\nlet Machines = dynamic({MachineInfo});\\r\\nSecurityEvent\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity})\\r\\n| where Activity == '{ActivityPiker}' or '{ActivityPiker}' == \\\"All\\\"\\r\\n| extend Name = extract(@'^(.*\\\\\\\\)?([^@]*)(@.*)?$', 2, tolower(Account))\\r\\n| where (Users.Type == '*' or (Users.Type == 'Computer' and Name == Users.Name)) and (Machines.Type == '*' or (Machines.Type == 'Computer' and Computer == Machines.Name))\\r\\n| extend Status = iif(Activity contains \\\"success\\\",\\\"?? Success\\\" , iif(Activity contains \\\"faile\\\", \\\"?Faile\\\", \\\"none\\\"))\\r\\n| summarize Count = count() by Name, Computer,AccountType, Activity, IpAddress , Process, CallerProcessId, CallerProcessName, CommandLine, FilePath, IpPort,GroupMembership, Status, bin(TimeGenerated, 1d), Detalis=\\\"more details\\\"\\r\\n| project  Name, Computer,AccountType, Activity, IpAddress, CallerProcessId, CallerProcessName, CommandLine, FilePath, IpPort, Process, GroupMembership, Status, TimeGenerated, Count, Detalis\\r\\n| order by Count\\r\\n\",         \"size\": 0,         \"exportParameterName\": \"Info\",         \"exportDefaultValue\": \"\\\"*\\\"\",         \"exportToExcelOptions\": \"visible\",         \"title\": \"Full details\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Name\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"AccountType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Activity\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"IpAddress\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CallerProcessId\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CallerProcessName\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CommandLine\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"FilePath\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"IpPort\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Process\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"GroupMembership\",               \"formatter\": 5,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Status\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 6,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"greenBlue\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Detalis\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"GenericDetails\",                 \"linkIsContextBlade\": true,                 \"showIcon\": true               }             },             {               \"columnMatch\": \"NumberOfProcess\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"detalis\",               \"formatter\": 7,               \"formatOptions\": {                 \"linkTarget\": \"GenericDetails\",                 \"linkIsContextBlade\": true,                 \"showIcon\": true               }             },             {               \"columnMatch\": \"count_\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"rowLimit\": 1000,           \"filter\": true,           \"labelSettings\": []         }       },       \"name\": \"query - 5\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let Users = dynamic({Userinfo});\\r\\nlet Info = dynamic({Info});\\r\\nlet Machines = dynamic({MachineInfo});\\r\\nSecurityEvent\\r\\n| where Info == \\\"*\\\" or Process == Info.Process\\r\\n| where Process != \\\"\\\" and Process != \\\"-\\\"\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity})\\r\\n| where Activity == '{ActivityPiker}' or '{ActivityPiker}' == \\\"All\\\"\\r\\n| extend Name = extract(@'^(.*\\\\\\\\)?([^@]*)(@.*)?$', 2, tolower(Account))\\r\\n| where (Users.Type == '*' or (Users.Type == 'Computer' and Name == Users.Name)) and (Machines.Type == '*' or (Machines.Type == 'Computer' and Computer == Machines.Name))\\r\\n| summarize Count = count() by Process, bin(TimeGenerated, 1h)\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Processes\",         \"color\": \"lightBlue\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"areachart\"       },       \"customWidth\": \"30\",       \"name\": \"query - 6\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let Users = dynamic({Userinfo});\\r\\nlet Info = dynamic({Info});\\r\\nlet Machines = dynamic({MachineInfo});\\r\\nSecurityEvent\\r\\n| where Process != \\\"\\\" and Process != \\\"-\\\"\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity})\\r\\n| where Activity == '{ActivityPiker}' or '{ActivityPiker}' == \\\"All\\\"\\r\\n| where Info == \\\"*\\\" or Process == Info.Process\\r\\n| extend user = extract(@'^(.*\\\\\\\\)?([^@]*)(@.*)?$', 2, tolower(Account))\\r\\n| where (Users.Type == '*' or (Users.Type == 'Computer' and user == Users.Name)) and (Machines.Type == '*' or (Machines.Type == 'Computer' and Computer == Machines.Name))\\r\\n| summarize Count = count() by Process, Activity, user, Computer, bin(TimeGenerated, 1h)\\r\\n| order by TimeGenerated, Count\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Processes details\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"filter\": true,           \"labelSettings\": []         }       },       \"customWidth\": \"70\",       \"name\": \"query - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"let Users = dynamic({Userinfo});\\r\\nlet Info = dynamic({Info});\\r\\nlet Machines = dynamic({MachineInfo});\\r\\nSecurityEvent\\r\\n| where LogonTypeName != \\\"\\\"\\r\\n| where \\\"{Activity:lable}\\\" == \\\"All\\\" or Activity in ({Activity})\\r\\n| where Activity == '{ActivityPiker}' or '{ActivityPiker}' == \\\"All\\\"\\r\\n| where Info == \\\"*\\\" or Activity == Info.Activity\\r\\n| extend user = extract(@'^(.*\\\\\\\\)?([^@]*)(@.*)?$', 2, tolower(Account))\\r\\n| where (Users.Type == '*' or (Users.Type == 'Computer' and user == Users.Name)) and (Machines.Type == '*' or (Machines.Type == 'Computer' and Computer == Machines.Name))\\r\\n| summarize Count = count() by LogonTypeName = strcat( \\\"Logon type: \\\", LogonTypeName), Activity, user\\r\\n| order by Count\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Logon activity types\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"LogonTypeName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Activity\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"user\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Count\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"palette\": \"green\",                 \"showIcon\": true,                 \"aggregation\": \"Sum\"               }             },             {               \"columnMatch\": \"$gen_group\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"filter\": true,           \"hierarchySettings\": {             \"treeType\": 1,             \"groupBy\": [               \"LogonTypeName\",               \"Activity\"             ],             \"expandTopLevel\": false           },           \"labelSettings\": []         }       },       \"customWidth\": \"70\",       \"name\": \"query - 7\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-IdentityAndAccess\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('security - LinuxMachines_id')]",
                          "properties":  {
                                             "displayName":  "security - Event Analyzer on Linux Machines",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Linux Machines\"       },       \"name\": \"text - 0\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"query\": \"\",         \"crossComponentResources\": [],         \"parameters\": [           {             \"id\": \"1025a43d-241c-4e40-95dc-c9eb9c789bc5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 1209600000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"bc241870-7874-4927-8c74-d17e747522b1\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Computer\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"Syslog\\r\\n| summarize syslogEventsCount = count() by Computer\\r\\n| sort by syslogEventsCount desc\\r\\n| project Computer\\r\\n\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"All\"             },             \"queryType\": 0,             \"resourceType\": \"microsoft.operationalinsights/workspaces\"           },           {             \"id\": \"e073f36e-2fb5-421d-9099-217205b247f5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Severity\",             \"type\": 2,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::all\"               ],               \"selectAllValue\": \"*\"             },             \"jsonData\": \"[\\\"Emergency\\\", \\\"Alert\\\", \\\"Critical\\\", \\\"Error\\\", \\\"Warning\\\", \\\"Notice\\\", \\\"Informational\\\", \\\"Debug\\\"]\",             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\"           }         ],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 1\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| summarize count() by SeverityLevel\\r\\n| extend severityNumber = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 0, iif(SeverityLevel == 'alert', 1, iif(SeverityLevel == 'crit', 2, iif(SeverityLevel == 'err' or SeverityLevel == 'error', 3, iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 4, iif(SeverityLevel == 'notice', 5, iif(SeverityLevel == 'info', 6, iif(SeverityLevel == 'debug', 7, 8))))))))\\r\\n| sort by severityNumber asc\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| project-away severityNumber\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n\",         \"size\": 4,         \"exportToExcelOptions\": \"visible\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"tiles\",         \"tileSettings\": {           \"titleContent\": {             \"columnMatch\": \"SeverityLevel\",             \"formatter\": 1,             \"formatOptions\": {               \"showIcon\": true             }           },           \"leftContent\": {             \"columnMatch\": \"count_\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"hotCold\",               \"showIcon\": true             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"style\": \"decimal\",                 \"maximumFractionDigits\": 2,                 \"maximumSignificantDigits\": 3               }             }           },           \"showBorder\": false,           \"sortOrderField\": 2         }       },       \"name\": \"query - 2\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| where SeverityLevel in (\\\"emerg\\\")\\r\\n| summarize count() by Computer, TimeGenerated\\r\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"\\\"Emergency\\\" level events, by computer\",         \"noDataMessage\": \"No emergency events within the defined scope\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 2 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| where SeverityLevel in (\\\"crit\\\")\\r\\n| summarize count() by Computer, TimeGenerated\\r\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"\\\"Critical\\\" level events, by computer\",         \"noDataMessage\": \"No critical events within the defined scope\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 2 - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| where SeverityLevel in (\\\"alert\\\")\\r\\n| summarize count() by Computer, TimeGenerated\\r\\n\",         \"size\": 1,         \"exportToExcelOptions\": \"visible\",         \"title\": \"\\\"Alert\\\" level events, by computer\",         \"noDataMessage\": \"No alert events within the defined scope\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"timechart\"       },       \"customWidth\": \"33\",       \"name\": \"query - 2 - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| extend SeverityNumber = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 0, iif(SeverityLevel == 'alert', 1, iif(SeverityLevel == 'crit', 2, iif(SeverityLevel == 'err' or SeverityLevel == 'error', 3, iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 4, iif(SeverityLevel == 'notice', 5, iif(SeverityLevel == 'info', 6, iif(SeverityLevel == 'debug', 7, 8))))))))\\r\\n| where Severity in ({Severity})\\r\\n|extend Computer = iif(isempty(_ResourceId), Computer, _ResourceId)\\r\\n| project TimeGenerated, Computer, SeverityLevel, SeverityNumber, Facility, HostIP, ProcessNameAndID = strcat(ProcessName, ' (', iff(isempty(ProcessID), \\\"-\\\", tostring(ProcessID)), ')')  \\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Events\",         \"noDataMessage\": \"No events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"TimeGenerated\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SeverityLevel\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SeverityNumber\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 7,                 \"max\": 0,                 \"palette\": \"redDark\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Facility\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"HostIP\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"ProcessNameAndID\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ],           \"labelSettings\": []         }       },       \"name\": \"query - 2 - Copy - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by SyslogMessage\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Syslog messages of events\",         \"noDataMessage\": \"No messages\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 7\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by Facility, ProcessName\\r\\n| project Process = strcat(ProcessName, ' (', Facility, ')'), Count = count_  \\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Process names of events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 11\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by Facility, SeverityLevel\\r\\n\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Event distribution, by facility\",         \"noDataMessage\": \"No events\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"piechart\"       },       \"customWidth\": \"50\",       \"name\": \"query - 7 - Copy - Copy - Copy\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Syslog\\r\\n| where \\\"{Computer:lable}\\\" == \\\"All\\\" or Computer in ({Computer})\\r\\n| extend Severity = iif(SeverityLevel == 'emerg' or SeverityLevel == 'panic', 'Emergency', iif(SeverityLevel == 'alert', 'Alert', iif(SeverityLevel == 'crit', 'Critical', iif(SeverityLevel == 'err' or SeverityLevel == 'error', 'Error', iif(SeverityLevel == 'warning' or SeverityLevel == 'warn', 'Warning', iif(SeverityLevel == 'notice', 'Notice', iif(SeverityLevel == 'info', 'Informational', iif(SeverityLevel == 'debug', 'Debug', 'Unknown'))))))))\\r\\n| where \\\"*\\\" in ({Severity}) or Severity in ({Severity})\\r\\n| summarize count() by Facility, SeverityLevel\",         \"size\": 0,         \"exportToExcelOptions\": \"visible\",         \"title\": \"Severity levels, by facility\",         \"timeContext\": {           \"durationMs\": 0         },         \"timeContextFromParameter\": \"TimeRange\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"visualization\": \"categoricalbar\"       },       \"customWidth\": \"50\",       \"name\": \"query - 11 - Copy\"     }   ],   \"styleSettings\": {},   \"fromTemplateId\": \"sentinel-LinuxMachines\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('security - InsecureProtocols_id')]",
                          "properties":  {
                                             "displayName":  "security - Insecure Protocols Check on Windows VM",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"## Insecure Protocols\\n\"       },       \"name\": \"text - 2\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [           {             \"id\": \"6b543dcb-ffbe-4fca-80d7-68d15257c377\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"DefaultSubscription_Internal\",             \"type\": 1,             \"isRequired\": true,             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| take 1\\r\\n| project subscriptionId\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"isHiddenWhenLocked\": true,             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\",             \"value\": \"\"           },           {             \"id\": \"959662e2-5c74-4876-b5c7-0aaeb2de2ca5\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Subscription\",             \"type\": 6,             \"query\": \"resources\\r\\n| summarize by subscriptionId\\r\\n| project value = strcat(\\\"/subscriptions/\\\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\",             \"crossComponentResources\": [               \"value::selected\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"timeContext\": {               \"durationMs\": 0             },             \"timeContextFromParameter\": \"TimeRange\",             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\",             \"value\": null           },           {             \"id\": \"d0ab5058-af8c-4ea2-b4a4-8d836769d278\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspace\",             \"type\": 5,             \"query\": \"resources\\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| project id\",             \"crossComponentResources\": [               \"{Subscription}\"             ],             \"value\": null,             \"typeSettings\": {               \"additionalResourceOptions\": []             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           },           {             \"id\": \"020de58b-73ca-47fe-838e-bc3ac7afaef6\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"TimeRange\",             \"type\": 4,             \"isRequired\": true,             \"value\": {               \"durationMs\": 604800000             },             \"typeSettings\": {               \"selectableValues\": [                 {                   \"durationMs\": 300000                 },                 {                   \"durationMs\": 900000                 },                 {                   \"durationMs\": 1800000                 },                 {                   \"durationMs\": 3600000                 },                 {                   \"durationMs\": 14400000                 },                 {                   \"durationMs\": 43200000                 },                 {                   \"durationMs\": 86400000                 },                 {                   \"durationMs\": 172800000                 },                 {                   \"durationMs\": 259200000                 },                 {                   \"durationMs\": 604800000                 },                 {                   \"durationMs\": 1209600000                 },                 {                   \"durationMs\": 2419200000                 },                 {                   \"durationMs\": 2592000000                 },                 {                   \"durationMs\": 5184000000                 },                 {                   \"durationMs\": 7776000000                 }               ],               \"allowCustom\": true             }           },           {             \"id\": \"39b2b987-3569-4bc8-96b4-85c43f1c275b\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Help\",             \"label\": \"Show Help\",             \"type\": 10,             \"description\": \"Toggle to show Help for each tab.\",             \"isRequired\": true,             \"typeSettings\": {               \"additionalResourceOptions\": [],               \"showDefault\": false             },             \"jsonData\": \"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\\r\\n\"           }         ],         \"style\": \"above\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\"       },       \"name\": \"parameters - 7\"     },     {       \"type\": 11,       \"content\": {         \"version\": \"LinkItem/1.0\",         \"style\": \"tabs\",         \"links\": [           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Summary\",             \"subTarget\": \"Summary\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"LDAP\",             \"subTarget\": \"LDAP\",             \"preText\": \"LDAP\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"NTLM\",             \"subTarget\": \"NTLM\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"SMB\",             \"subTarget\": \"SMB\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Kerberos\",             \"subTarget\": \"Kerberos\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"WDigest\",             \"subTarget\": \"WDigest\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"AAD Legacy Auth \",             \"subTarget\": \"AADLegacy\",             \"style\": \"link\"           },           {             \"cellValue\": \"selectedTab\",             \"linkTarget\": \"parameter\",             \"linkLabel\": \"Vulnerable Secure Channel\",             \"subTarget\": \"NetlogonSC\",             \"style\": \"link\"           }         ]       },       \"name\": \"links - 34\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"### Change Log\\r\\nBrian Delaney, Clive Watson, Jon Shectman - Microsoft \u003cbr\u003e\\r\\n\\t\\r\\n\\tVersion v1.8\\r\\n\\tAdded Vulnerable Netlogon Secure Channel\\r\\n\\tAdded Legacy Authentication to Summary\\r\\n\\tFixed reporting of Weak Kerberos Cipher in summary\\r\\n\\t\\r\\n\\t\\r\\n\\tVersion v1.7\\r\\n\\tAdded Tabs\\r\\n\\tFixed a bug\\r\\n\\tAdded Timebrushing and Groupings\\r\\n\\tAdded Help sections\",         \"style\": \"info\"       },       \"conditionalVisibility\": {         \"parameterName\": \"Help\",         \"comparison\": \"isEqualTo\",         \"value\": \"Change Log\"       },       \"customWidth\": \"30\",       \"name\": \"text - 24\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Summary\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### Welcome to Insecure Protocols Workbook\\r\\nThis workbook will help you audit and remove Insecure Protocols from your Active Directory and Azure Active Directory estates.\u003cbr\u003e\\r\\nFor more information about this workbook (and for help with audit settings), navigate to [here](https://aka.ms/sentinelipsetup).\u003cbr\u003e\\r\\nFor help as you navigate this workbook, toggle Show Help at the page top.\",               \"style\": \"info\"             },             \"customWidth\": \"70\",             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 24 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nlet legacyAuth = SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by Protocol=\\\"AAD Legacy Auth\\\";\\r\\nSecurityEvent\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| union Event\\r\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\") or ((EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\") and EventID in (scEvents))\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\\r\\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\\r\\n| extend Protocol = case(EventID == 4776, \\\"WDigest\\\", EventID == 4768 or EventID == 4769, \\\"Weak Kerberos Cipher\\\", EventID == 2889, \\\"Insecure LDAP\\\", EventID == 4624, \\\"NTLM v1\\\", EventID == 3000, \\\"SMBv1\\\", EventID in (scEvents), \\\"Vulnerable Secure Channel\\\", \\\"Unknown\\\")\\r\\n| project Protocol, Count\\r\\n| union legacyAuth\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Summary of Insecure Protocols: {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"series\",               \"exportParameterName\": \"SelectedProtocol\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"piechart\",               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"Count\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Count\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"40\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Summary\"             },             \"name\": \"IPbyTypePie\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nlet legacyAuth = SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Protocol=\\\"AAD Legacy Auth\\\";\\r\\nSecurityEvent\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| union Event\\r\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\") or ((EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\") and EventID in (scEvents))\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), tostring(EventID)\\r\\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\\r\\n| extend Protocol = case(EventID == 4776, \\\"WDigest\\\", EventID == 4768 or EventID == 4769, \\\"Weak Kerberos Cipher\\\", EventID == 2889, \\\"Insecure LDAP\\\", EventID == 4624, \\\"NTLM v1\\\", EventID == 3000, \\\"SMBv1\\\", EventID in (scEvents), \\\"Vulnerable Secure Channel\\\", \\\"Unknown\\\")\\r\\n| project Protocol, Count, TimeGenerated\\r\\n| union legacyAuth\\r\\n| where Protocol =~ \\\"{SelectedProtocol}\\\" or \\\"{SelectedProtocol}\\\" =~ \\\"All\\\"\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Summary of Insecure Protocols: {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"barchart\",               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"Count\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Count\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"60\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Summary\"             },             \"name\": \"IPbyTypeandTimeBar\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nlet legacyAuth = SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by Protocol=\\\"AAD Legacy Auth\\\";\\r\\nSecurityEvent\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| union Event\\r\\n| where (EventID == 2889) or (EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit') or (EventID == 4624 and AuthenticationPackageName == 'NTLM' and LmPackageName == 'NTLM V1' and Account !contains 'ANONYMOUS LOGON') or ((EventID == 4624 or EventID == 4776) and Level == 8 and PackageName contains 'WDigest') or (EventID == 4768 or EventID == 4769) and Level == 8 and (TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\") or ((EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\") and EventID in (scEvents))\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by tostring(EventID)\\r\\n//| extend Protocol=replace(tostring(4776), 'WDigest', replace(tostring(4768), 'Kerberos weak cipher', replace(tostring(4769), 'Kerberos weak cipher', replace(tostring(2889), 'Insecure LDAP', replace(tostring(4624), 'NTLM v1', replace(tostring(3000), 'SMB v1', tostring(EventID)))))))\\r\\n| extend Protocol = case(EventID == 4776, \\\"WDigest\\\", EventID == 4768 or EventID == 4769, \\\"Weak Kerberos Cipher\\\", EventID == 2889, \\\"Insecure LDAP\\\", EventID == 4624, \\\"NTLM v1\\\", EventID == 3000, \\\"SMBv1\\\", EventID in (scEvents), \\\"Vulnerable Secure Channel\\\", \\\"Unknown\\\")\\r\\n| summarize FirstOccurance=min(FirstOccurance), LastOccurance=max(LastOccurance), Count=sum(Count) by Protocol\\r\\n| union legacyAuth\\r\\n| sort by Count desc\\r\\n\",               \"size\": 1,               \"title\": \"Summary of Insecure Protobols found in: {TimeRange:label}\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"sortBy\": [],               \"tileSettings\": {                 \"showBorder\": false               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"TableName\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"centerContent\": {                   \"columnMatch\": \"Normal EventID\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"nodeIdField\": \"excellent_ok\",                 \"sourceIdField\": \"TableName\",                 \"targetIdField\": \"excellent_ok\",                 \"edgeLabel\": \"excellent_ok\",                 \"nodeSize\": null,                 \"staticNodeSize\": 100,                 \"colorSettings\": null,                 \"groupByField\": \"TableName\",                 \"hivesMargin\": 5               },               \"chartSettings\": {                 \"group\": \"Crucial EventID\",                 \"createOtherGroup\": null               }             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Summary\"             },             \"name\": \"SummaryByIP\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Summary\"       },       \"name\": \"group - Summary\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Insecure LDAP\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### LDAP Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* Clients are returning unsigned traffic, which is susceptible to replay or attacker-in-the-middle attacks.\\r\\n\\t* This may result in nefarious activity, such as modified packets, in which a server or even a person makes decisions based on forged data.\\r\\n\\t* The organization is exposing its highly-privileged authentication principals' credentials ??such as the ones for those that belong to the Domain Admins group. With a simple network capture, an attacker can steal these credentials and achieve an escalation path or even a domain dominance type scenario. In the case of simple binds, the organization is exposing plaintext authentication credentials.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Set auditing for 2889 on every DC - In the registry key ??KLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\NTDS\\\\Diagnostics??set a DWORD with name \\\"16 LDAP Interface Events??to a value of ??\\\"\\r\\n\\t* In Log Analytics/Sentinel, set log collection from the Directory Service log.\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners, vendors, and users to use LDAP over TLS (LDAPS://) ??ports 636 and 3269.\\r\\n\\t* Once there is no more 2889 insecure LDAP traffic, set the DCs to no longer accept it. GPO: Computer Configuration\\\\Windows Settings\\\\Security Settings\\\\Local Policies\\\\Security Options\\r\\n\\t* If this is not possible, you can secure the entire exchange with IPSec. However, you will not be able to disallow insecure LDAP at the DCs; so using LDAPS is recommended.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Account\\r\\n\\t* Account timebrush\\r\\n\\t* IP\\r\\n\\t* IP timebrush\",               \"style\": \"info\"             },             \"customWidth\": \"100\",             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 11\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend Title = \\\"Number of events\\\"\\r\\n | summarize QueryCount = count(EventID) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\",               \"size\": 4,               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Title\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"QueryCount\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"20\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 9\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend Title = \\\"Number of Accounts\\\"\\r\\n | summarize QueryCount = dcount(Account) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\",               \"size\": 4,               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Title\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"QueryCount\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"min\": 0,                     \"palette\": \"purple\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"style\": \"decimal\",                       \"maximumFractionDigits\": 2,                       \"maximumSignificantDigits\": 3                     }                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"20\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 10\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend Title = \\\"Number of IP Addresses\\\"\\r\\n | summarize QueryCount =  dcount(IPAddress) by Title//, NumberOfIPs = dcount(IPAddress), NumberOfAccounts = dcount(Account)\",               \"size\": 4,               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Title\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"QueryCount\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"20\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 9 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | summarize QueryCount = count(EventID) by Account, IPAddress\\r\\n | order by QueryCount\\r\\n\",               \"size\": 0,               \"title\": \"By Account - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Account\",               \"exportParameterName\": \"Account\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"QueryCount\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"TimeGenerated\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"sortBy\": [                   {                     \"itemKey\": \"$gen_bar_QueryCount_2\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"Account\"                   },                   {                     \"columnId\": \"IPAddress\",                     \"label\": \"Source IP\"                   },                   {                     \"columnId\": \"QueryCount\",                     \"label\": \"Number of Insecure Binds\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"$gen_bar_QueryCount_2\",                   \"sortOrder\": 2                 }               ]             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"LDAP by Account\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\"All\\\"\\r\\n | project Account, IPAddress, Computer, RenderedDescription, UserName, EventID, Time_of_Bind=TimeAgo\",               \"size\": 0,               \"title\": \"Account Details\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Account\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"UserName\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventID\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"Account\"                   },                   {                     \"columnId\": \"IPAddress\",                     \"label\": \"Source IP\"                   },                   {                     \"columnId\": \"Computer\",                     \"label\": \"Domain Controller\"                   },                   {                     \"columnId\": \"Time_of_Bind\",                     \"label\": \"Binding Time\"                   }                 ]               }             },             \"conditionalVisibilities\": [               {                 \"parameterName\": \"selectedTab\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"LDAP\"               },               {                 \"parameterName\": \"False\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"Yes\"               }             ],             \"name\": \"query - 7\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\"All\\\"\\r\\n | summarize count() by Account, bin(TimeGenerated, {TimeRange:grain})\",               \"size\": 0,               \"title\": \"Account events over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"LDAPTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 11\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where Account == '{Account:escape}' or  '{Account:escape}' == \\\"All\\\"\\r\\n | extend BindingType = case(BindingType==0,\\\"Unsigned\\\",BindingType==1,\\\"Simple\\\",\\\"Unknown\\\")\\r\\n | summarize Count=count() by Account, bin(TimeGenerated, {TimeRange:grain}), BindingType\\r\\n| order by Count\",               \"size\": 0,               \"title\": \"Account events over time ({LDAPTimebrushAccount:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"LDAPTimebrushAccount\",               \"timeBrushParameterName\": \"LDAPTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"TimeGenerated\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"palette\": \"blue\"                     }                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 11 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Account '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | summarize QueryCount = count(EventID) by IPAddress, Account\\r\\n\",               \"size\": 0,               \"title\": \"By Source IP - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"IPAddress\",               \"exportParameterName\": \"IPAddress\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Account\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"QueryCount\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"blueDark\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   },                   {                     \"columnMatch\": \"Account Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"Trend\",                     \"formatter\": 9,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"magenta\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ParentId\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"LDAPClient\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   }                 ],                 \"sortBy\": [                   {                     \"itemKey\": \"$gen_bar_QueryCount_2\",                     \"sortOrder\": 2                   }                 ],                 \"labelSettings\": [                   {                     \"columnId\": \"IPAddress\",                     \"label\": \"Source IP\"                   },                   {                     \"columnId\": \"Account\"                   },                   {                     \"columnId\": \"QueryCount\",                     \"label\": \"Number of Insedcure Binds\"                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"$gen_bar_QueryCount_2\",                   \"sortOrder\": 2                 }               ]             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Accounts '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\"All\\\"\\r\\n | project IPAddress, Accounts, Computer, RenderedDescription, UserName, EventID, Time_of_Bind=TimeAgo\",               \"size\": 0,               \"title\": \"Source IP Details\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"IPAddress\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"UserName\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventID\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibilities\": [               {                 \"parameterName\": \"selectedTab\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"LDAP\"               },               {                 \"parameterName\": \"False\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"Yes\"               }             ],             \"name\": \"query - 8\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Accounts '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\"All\\\"\\r\\n | summarize count() by IPAddress, bin(TimeGenerated, {TimeRange:grain})\",               \"size\": 0,               \"title\": \"IP addresses events over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"LDAPTimebrushIP\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 12\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n | where EventID == 2889 \\r\\n | parse ParameterXml with * '\u003e\u003cParam\u003e' Accounts '\u003c/' *\\r\\n | parse ParameterXml with * '\u003cParam\u003e' IPAddress ':' * \\r\\n | parse kind = regex ParameterXml with * '\u003c/Param\u003e\u003cParam\u003e' * '\u003c/Param\u003e\u003cParam\u003e' BindingType '\u003c/Param\u003e'\\r\\n | extend TimeFromNow = now() - TimeGenerated\\r\\n | extend TimeAgo = strcat(case(TimeFromNow \u003c 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow \u003c 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow \u003c 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\\r\\n | where IPAddress == '{IPAddress:escape}' or '{IPAddress:escape}' == \\\"All\\\"\\r\\n| extend BindingType = case(BindingType==0,\\\"Unsigned\\\",BindingType==1,\\\"Simple\\\",\\\"Unknown\\\")\\r\\n | summarize Count = count() by IPAddress, bin(TimeGenerated, {TimeRange:grain}), BindingType\\r\\n | order by Count\",               \"size\": 0,               \"title\": \"IP addresses events over time ({LDAPTimebrushIP:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"LDAPTimebrushIP\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"QueryCount\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"palette\": \"blue\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"aggregation\": \"Sum\"                     }                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"LDAP\"             },             \"name\": \"query - 12 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"LDAP\"       },       \"name\": \"group - LDAP\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: NTLMv1\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### NTLM Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* It is far less complex for an attacker to anticipate the challenge length in NTLMv1, as it is always a 16-byte random number. NTLMv2, on the other hand, uses a challenge of variable length.\\r\\n\\t* Recall also that NTLMv1 uses DES encryption, whereas NTLMv2 uses the stronger HMAC-MD5. As of now, it?? less likely that an attacker can successfully brute-force HMAC-MD5.\\r\\n\\t* Also, because NTLMv1 is so much less secure, the only protocols that Windows Defender Credential Guard supports are Kerberos and NTLMv2. You??l have to address the sources of NTLMv1 before using Credential Guard.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Set auditing for 4624 and 4625, and also for 4776 via Group Policy.\\r\\n\\t\\t* Windows Settings/Security Settings/Advanced Audit Configuration/Account Logon/Logon/Logoff/Audit Credential Validation with value of ??uccess, Failure.??r\\n\\t\\t* Windows Settings/Security Settings/Advanced Audit Configuration/(Logon/Logoff)/Audit Logoff with value of \\\"Success, Failure.\\\"\\r\\n\\t\\t* Windows Settings/Security Settings/Advanced Audit Configuration/(Logon/Logoff)/Audit Logon with value of \\\"Success, Failure.\\\"\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners and vendors to use a more secure protocol like Kerberos or NTLMv2.\\r\\n\\t* Where unsupported operating systems, old applications or outdated appliances cannot use Kerberos or NTLMv2, work with decision makers to understand the risks to the organization.\\r\\n\\t* Create a plan to remove the problem devices, applications and appliances from the network.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Source and server\\r\\n\\t* Timebrush\\r\\n\\t* NTLM v1 event details by time\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent \\r\\n| where EventID == 4624 \\r\\n| where AuthenticationPackageName == 'NTLM' \\r\\n| where LmPackageName == 'NTLM V1'  \\r\\n| where Account !contains 'ANONYMOUS LOGON' \\r\\n| summarize Count = count() by WorkstationName, Computer \\r\\n| project WorkstationName, Computer, Count\\r\\n| order by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"NTLM v1 events, by Source and server - click to filter\",               \"exportFieldName\": \"\",               \"exportParameterName\": \"WorkstationName\",               \"exportDefaultValue\": \"{\\\"WorkstationName\\\":\\\"All\\\"}\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"WorkstationName\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"WorkstationName\"                   ]                 },                 \"sortBy\": [                   {                     \"itemKey\": \"Computer\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"Computer\",                   \"sortOrder\": 2                 }               ],               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"WorkstationName\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"NTLM\"             },             \"name\": \"query - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent \\r\\n| where EventID == 4624 \\r\\n| where AuthenticationPackageName == 'NTLM' \\r\\n| where LmPackageName == 'NTLM V1'  \\r\\n| where Account !contains 'ANONYMOUS LOGON' \\r\\n| where '{WorkstationName:escape}' contains \\\"All\\\" or '{WorkstationName:escape}' contains WorkstationName\\r\\n| summarize Count=count() by WorkstationName, Day=bin(TimeGenerated, {TimeRange:grain}) \",               \"size\": 0,               \"title\": \"NTLM v1 events, by time - select to timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"NTLMTimebrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"areachart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"NTLM\"             },             \"name\": \"query - 15\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent \\r\\n| where EventID == 4624 \\r\\n| where AuthenticationPackageName == 'NTLM' \\r\\n| where LmPackageName == 'NTLM V1'  \\r\\n| where Account !contains 'ANONYMOUS LOGON' \\r\\n| where '{WorkstationName:escape}' contains \\\"All\\\" or ('{WorkstationName:escape}' contains WorkstationName and '{WorkstationName:escape}' contains Computer)\\r\\n| summarize Count = count() by Account, WorkstationName, DC=Computer, LogonProcessName, TargetDomainName, TargetAccount, IpAddress\\r\\n| sort by Count desc  \",               \"size\": 0,               \"title\": \"NTLM v1 events details ({NTLMTimebrush:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"NTLMTimebrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"palette\": \"greenRed\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"NTLM\"             },             \"name\": \"query - 16\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"NTLM\"       },       \"name\": \"Group - NTLM\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: SMBv1\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### SMB Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* The security built into SMBv2 and SMBv3 is primarily around protecting against security downgrade attacks (Pre-authentication Integrity, Secure Dialect Negotiation) and attacker-in-the-middle attacks (Encryption, Insecure guest auth blocking). SMB1 simply doesn?? know about or contain any of these protections.\\r\\n\\t* If you have SMBv1 enabled on your file servers or domain controllers, then an attacker-in-the-middle can simply block SMB2/3 and force a downgrade attack. The net effect here will be that your computer(s) will gracefully flip over to SMBv1, thereby exposing the exchange?? data.\\r\\n\\t* SMBv1 continues to be a primary component in destructive ransomware attacks.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* On the servers that you will audit, run the following Powershell command to enable auditing: Set-SmbServerConfiguration ??uditSmb1Access $true\\r\\n\\t* Note that this auditing is only supported on Sever 2016/Windows 10 and Server 2012 R2/Windcows 8.1 via an update.\\r\\n\\t* Finally, in the Log Analytics configuration, you will need to set ??ollect events from the following event logs??to Microsoft-Windows-SMBServer/Audit and set the log type to INFORMATION.\\\"\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners and vendors to use a more secure SMB version, such as SMBv2 or SMBv3.\\r\\n\\t* Once there is no more SMBv1, set the DCs to no longer accept it. Registry key: HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\LanmanServer\\\\Parameters\\r\\n\\tSet this to a value SMB1 REG_DWORD: 0 = Disabled.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Events by client \\r\\n\\t* Server timebrush\\r\\n\\t* Events by server\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let data = Event\\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit' \\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' * \\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress))));\\r\\ndata\\r\\n| summarize Count = count() by Client\\r\\n| join kind = fullouter (datatable(Client:string)['Medium', 'high', 'low']) on Client\\r\\n| project Client = iff(Client == '', Client1, Client), Count = iff(Client == '', 0, Count)\\r\\n| join kind = inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Client)\\r\\n on Client\\r\\n| project-away Client1, TimeGenerated\\r\\n| extend Clients = Client\\r\\n| union (\\r\\n data \\r\\n | summarize Count = count() \\r\\n | extend jkey = 1\\r\\n | join kind=inner (data\\r\\n | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\\r\\n | extend jkey = 1) on jkey\\r\\n | extend Client = 'All', Clients = '*' \\r\\n)\\r\\n| order by Count desc\\r\\n| take 10\\r\\n\",               \"size\": 4,               \"title\": \"SMB v1 events, by client - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Client\",               \"exportParameterName\": \"ClientFilter\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"titleContent\": {                   \"columnMatch\": \"Client\",                   \"formatter\": 1,                   \"formatOptions\": {                     \"showIcon\": true                   }                 },                 \"leftContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\",                     \"showIcon\": true                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 },                 \"secondaryContent\": {                   \"columnMatch\": \"Trend\",                   \"formatter\": 9,                   \"formatOptions\": {                     \"min\": 0,                     \"palette\": \"purple\",                     \"showIcon\": true                   }                 },                 \"showBorder\": false               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 18\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event\\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit'\\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' *\\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress))))\\r\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\"All\\\"\\r\\n| summarize Count=count() by Client, SMBServer=Computer, ParameterXml, RenderedDescription, EventData\\r\\n| sort by Count desc\",               \"size\": 1,               \"title\": \"SMB v1 event details, by client\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"barchart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Client\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"SMBServer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"ParameterXml\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenBlue\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   },                   {                     \"columnMatch\": \"$gen_group\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"Client\"                   ]                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 20\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event \\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit' \\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' * \\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress)))) \\r\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\"All\\\"\\r\\n| summarize Count=count() by bin(TimeGenerated, 1h) , SMBServer=Computer \\r\\n\\r\\n\",               \"size\": 0,               \"title\": \"SMB v1 events, by server - select to timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"SMBtimebrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 19\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"Event\\r\\n| where EventID == 3000 and EventLog == 'Microsoft-Windows-SMBServer/Audit'\\r\\n| parse ParameterXml with * '\u003cParam\u003e' ClientAddress '\u003c/' *\\r\\n| extend Client = replace(@'\u003e', @'', replace(@'\\\\]', @'', replace(@'\\\\[', @'', replace(@'\u003c!\\\\[CDATA', @'', ClientAddress))))\\r\\n| where Client == '{ClientFilter}' or '{ClientFilter}' == \\\"All\\\"\\r\\n| summarize Count=count() by Client, SMBServer=Computer, ParameterXml, RenderedDescription, EventData\\r\\n| sort by Count desc\",               \"size\": 0,               \"title\": \"SMBv1 events, by server: {SMBtimebrush:label}\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"SMBtimebrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Client\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"SMBServer\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"ParameterXml\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"RenderedDescription\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenBlue\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   },                   {                     \"columnMatch\": \"$gen_group\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true,                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true,                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"Client\"                   ]                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"SMB\"             },             \"name\": \"query - 20 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"SMB\"       },       \"name\": \"group - SMBv1\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Kerberos Ciphers\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### Kerberos Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t\\r\\n\\tWhen weak cipher suites are permitted for the Kerberos protocol, attackers can leverage encryption downgrades to their advantage and make the protocol easier to compromise.\\r\\n\\tPossible encryption types:\\r\\n\\t* DES_CBC_CRC | Weak\\r\\n\\t* DES_CBC_MD5 | Weak\\r\\n\\t* RC4_HMAC_MD5 | Moderate\\r\\n\\t* AES128_HMAC_SHA1 | Strong\\r\\n\\t* AES256_HMAC_SHA1 | Strong\\r\\n\\t\\r\\n\\tStarting in Windows Server 2008 / Windows Vista, AES encryption has been available for the Kerberos protocol. At present, all supported versions of Windows have DES encryption for Kerberos disabled by default. While DES can be enabled for backward compatibility, doing so will open up an attack vector.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t\\r\\n\\tUnder Account Logon, set the following audit settings to Success, Failure\\r\\n\\t\\t* Audit Kerberos Authentication Service\\r\\n\\t\\t* Audit Kerberos Service Ticket Operations\\r\\n\\tUnder Logon/Logoff set the following settings to Success, Failure\\r\\n\\t\\t* Audit Logon\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Weak Kerberos Ciphers can be caused by downlevel Operating Systems (Client or Server), Account Configuration issues, Trust Configuration Issues or 3rd party OS/Software configuration.\\r\\n\\t* Look for patterns in the data that will help identify the cause of the weak cipher, such as accessing a common service, or a common set of workstations.\\r\\n\\t* Once identified, work with the OS/Account/Trust owners to remediate the requirement for the weak cipher.\\r\\n\\t* When the weak ciphers have been eliminated from the environment, disable them across your Windows Computers in the policy Computer Configuration\\\\Windows Settings\\\\Security Setting\\\\Local Policies\\\\Security Options\\\\Network security: Configure encryption types allowed for Kerberos.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Timebrush\\r\\n\\t* Weak ciphers event details\\r\\n\\t* Weak ciphers event details by account\\r\\n\\r\\n** References **\\r\\n- [Network security: Configure encryption types allowed for Kerberos](https://docs.microsoft.com/windows/security/threat-protection/security-policy-settings/network-security-configure-encryption-types-allowed-for-kerberos)\\r\\n- [Advanced Security Audit Policy Settings](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn319056%28v=ws.11%29)\\r\\n\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 4\",             \"styleSettings\": {               \"margin\": \"5\"             }           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize Count=count() by Cipher\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Cipher\",               \"exportParameterName\": \"CipherParameter\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"blue\"                     }                   }                 ]               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Cipher\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 22 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| where Cipher == '{CipherParameter}' or '{CipherParameter}' == \\\"All\\\"\\r\\n| summarize Count=count() by Cipher, IpAddress, TargetUserName , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details - filtered by cipher\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"TargetUserName\",               \"exportParameterName\": \"targetUserNameKerberosParameter\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"IpAddress\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"ServiceName\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 23 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize Count=count() by Cipher, bin(TimeGenerated, 1h)\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers - select to timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"KeberosTimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"areachart\"             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 22\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize Count=count() by Cipher, IpAddress, TargetUserName , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details: {KeberosTimeBrush:label} - select TargetUserName for details\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"KeberosTimeBrush\",               \"exportFieldName\": \"TargetUserName\",               \"exportParameterName\": \"targetUserNameKerberosParameter\",               \"exportDefaultValue\": \"All\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"IpAddress\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"ServiceName\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Computer\",                     \"formatter\": 5                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 23\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| extend IpAddress = tostring(split(IpAddress,\\\"f:\\\").[1])\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n//| where TargetUserName in ('{targetUserNameKerberosParameter}')\\r\\n| where TargetUserName == '{targetUserNameKerberosParameter:escape}' or  '{targetUserNameKerberosParameter:escape}' == \\\"All\\\"\\r\\n| summarize OldestRecord = min(TimeGenerated), NewestRecord = max(TimeGenerated), Count=count() by TargetUserName, Cipher, IpAddress , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details: {targetUserNameKerberosParameter}, {KeberosTimeBrush:label}\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"KeberosTimeBrush\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TargetUserName\"                   },                   {                     \"columnId\": \"Cipher\"                   },                   {                     \"columnId\": \"IpAddress\"                   },                   {                     \"columnId\": \"ServiceName\"                   },                   {                     \"columnId\": \"Computer\"                   }                 ]               },               \"sortBy\": []             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"Kerberos\"             },             \"name\": \"query - 23 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SecurityEvent\\r\\n| where EventID == 4768 or EventID == 4769\\r\\n| where Level == 8\\r\\n| parse EventData with * '\\\"TicketEncryptionType\\\"\u003e' TicketEncryptionType '\u003c' *\\r\\n| where TicketEncryptionType != \\\"0x12\\\" and TicketEncryptionType != \\\"0x11\\\" //AES128/256, this filter needs to be activated\\r\\n| parse EventData with * '\\\"IpAddress\\\"\u003e' IpAddress '\u003c' *\\r\\n| extend IpAddress = tostring(split(IpAddress,\\\"f:\\\").[1])\\r\\n| parse EventData with * '\\\"TargetUserName\\\"\u003e' TargetUserName '\u003c' *\\r\\n| parse EventData with * '\\\"ServiceName\\\"\u003e' ServiceName '\u003c' *\\r\\n| extend Cipher=replace('0x18$', 'RC4-HMAC-EXP', replace('0x12$', 'AES256-CTS-HMAC-SHA1', replace('0x11$', 'AES128-CTS-HMAC-SHA1', replace('0x1$', 'DES_CBC_CRC', replace('0x2$', 'DES_CBC_MD4', replace('0x7$', 'DES3_CBC_SHA1', replace('0x5$', 'DES3_CBC_MD5', replace('0x3$', 'DES_CBC_MD5', replace('0x17$', 'RC4_HMAC', TicketEncryptionType)))))))))\\r\\n| summarize OldestRecord = min(TimeGenerated), NewestRecord = max(TimeGenerated), Count=count() by TargetUserName, Cipher, IpAddress , ServiceName, Computer, Activity\\r\\n| sort by Count desc\\r\\n\",               \"size\": 0,               \"title\": \"Kerberos weak ciphers event details unfiltered\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Cipher\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"EventData\",                     \"formatter\": 7,                     \"formatOptions\": {                       \"linkTarget\": \"GenericDetails\",                       \"linkIsContextBlade\": true                     }                   },                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"greenRed\"                     }                   }                 ],                 \"filter\": true,                 \"labelSettings\": [                   {                     \"columnId\": \"TargetUserName\"                   },                   {                     \"columnId\": \"Cipher\"                   },                   {                     \"columnId\": \"IpAddress\"                   },                   {                     \"columnId\": \"ServiceName\"                   },                   {                     \"columnId\": \"Computer\"                   }                 ]               },               \"sortBy\": []             },             \"conditionalVisibilities\": [               {                 \"parameterName\": \"selectedTab\",                 \"comparison\": \"isEqualTo\",                 \"value\": \"Kerberos\"               },               {                 \"parameterName\": \"targetUserNameKerberosParameter\",                 \"comparison\": \"isNotEqualTo\"               }             ],             \"name\": \"query - 23 - Copy - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"Kerberos\"       },       \"name\": \"Group - Kerberos\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: WDigest\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### WDigest Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* WDigest is a deprecated protocol. It injects plain-text passwords into memory.\\r\\n\\t* Attackers can simply read the plaintext passwords using commodity tools.\\r\\n\\t* Also, because WDigest is so much less secure, it is not supported in Windows Defender Credential Guard. You??l have to address the sources of WDigest before using Credential Guard.\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Set auditing for 4776 (non-Kerberos logon) ??Windows Settings/Security Settings/Advanced Audit Configuration/Account Logon/ Logon/Logoff/Audit Credential Validation with value of ??uccess, Failure.??r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Work with application owners and vendors to use a more secure protocol like NTLMv2 or Kerberos.\\r\\n\\t* Once there is no more Digest, set the DCs to no longer accept it. Registry (may be done via GP Preferences): HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\SecurityProviders\\\\WDigest\\\\ ??seLogonCredential\\r\\n\\t* Set this to a value of 0. A restart is required.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Account workstation\\r\\n\\t* Workstation over time\\r\\n\\t* Account timebrush\\r\\n\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 3\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let data = SecurityEvent \\r\\n| where EventID == 4624 or EventID == 4776 \\r\\n| where Level == 8 \\r\\n| where PackageName contains 'WDigest';\\r\\nlet appData = data\\r\\n| summarize TotalCount = count() by TargetAccount\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by TargetAccount\\r\\n    | project-away TimeGenerated) on TargetAccount\\r\\n| order by TotalCount desc, TargetAccount asc\\r\\n| project TargetAccount, TotalCount, Trend\\r\\n| serialize Id = row_number();\\r\\ndata\\r\\n| summarize TotalCount = count() by Workstation , TargetAccount\\r\\n| join kind=inner (data\\r\\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by TargetAccount, Workstation\\r\\n    | project-away TimeGenerated) on TargetAccount, Workstation\\r\\n| order by TotalCount desc, TargetAccount asc\\r\\n| project TargetAccount, Workstation, TotalCount, Trend\\r\\n| serialize Id = row_number(1000000)\\r\\n| join kind=inner (appData) on TargetAccount\\r\\n| project Id, Name = Workstation, Type = 'Workstation', ['TargetAccounts Count'] = TotalCount, Trend,  ParentId = Id1\\r\\n| union (appData \\r\\n    | project Id, Name = TargetAccount, Type = 'TargetAccount', ['TargetAccounts Count'] = TotalCount,  Trend)\\r\\n| order by ['TargetAccounts Count'] desc, Name asc\\r\\n\",               \"size\": 0,               \"title\": \"WDigest, by account workstation - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportParameterName\": \"WDigest\",               \"exportDefaultValue\": \"{ \\\"Name\\\":\\\"\\\", \\\"Type\\\":\\\"*\\\"}\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Id\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"TargetAccounts Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"Trend\",                     \"formatter\": 10,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"orange\",                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ParentId\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   }                 ],                 \"hierarchySettings\": {                   \"idColumn\": \"Id\",                   \"parentColumn\": \"ParentId\",                   \"treeType\": 0,                   \"expanderColumn\": \"Name\"                 }               },               \"graphSettings\": {                 \"type\": 0,                 \"topContent\": {                   \"columnMatch\": \"Name\",                   \"formatter\": 1                 },                 \"centerContent\": {                   \"columnMatch\": \"Id\",                   \"formatter\": 1,                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"WDigest\"             },             \"name\": \"query - 25\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let details = dynamic({WDigest});\\r\\nSecurityEvent \\r\\n| where EventID == 4624 or EventID == 4776 \\r\\n| where Level == 8 \\r\\n| where PackageName contains 'WDigest' \\r\\n| where (details.Type == 'Workstation' and details.Name == Workstation) or (details.Type == 'TargetAccount' and details.Name == TargetAccount) or (details.Type == '*')\\r\\n| summarize Count=count() by Workstation,  bin(TimeGenerated, 1h)\",               \"size\": 0,               \"title\": \"WDigest Workstation over Time\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"wDigestTimeBrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"areachart\"             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"WDigest\"             },             \"name\": \"query - 26\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let details = dynamic({WDigest});\\r\\nSecurityEvent\\r\\n| where EventID == 4624 or EventID == 4776\\r\\n| where Level == 8\\r\\n| where PackageName contains 'WDigest'\\r\\n| where (details.Type == 'Workstation' and details.Name == Workstation) or (details.Type == 'TargetAccount' and details.Name == TargetAccount) or (details.Type == '*')\\r\\n| summarize Count=count() by TargetAccount, Workstation, WDigestServer=Computer , Activity\\r\\n| sort by Count desc\",               \"size\": 0,               \"title\": \"WDigest Account over time {{wDigestTimeBrushAccount:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"wDigestTimeBrushAccount\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"coldHot\",                       \"showIcon\": true                     }                   }                 ],                 \"filter\": true               }             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"WDigest\"             },             \"name\": \"query - 27\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"WDigest\"       },       \"name\": \"WDigest\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: AAD Legacy Auth\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### AAD Legacy Auth Help File\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* Legacy authentication protocols like POP, SMTP, IMAP, and MAPI can't enforce MFA, making them preferred entry points for adversaries attacking your organization.\\r\\n\\t* The numbers on legacy authentication from an analysis of Azure Active Directory (Azure AD) traffic are stark:\\r\\n\\t\\t* More than 99 percent of password spray attacks use legacy authentication protocols\\r\\n\\t\\t* More than 97 percent of credential stuffing attacks use legacy authentication\\r\\n\\t\\t* Azure AD accounts in organizations that have disabled legacy authentication experience 67 percent fewer compromises than those where legacy authentication is enabled\\r\\n\\r\\n**Legacy Authentication Protocols**\\r\\nThe following options are considered legacy authentication protocols\\r\\n\\t* Authenticated SMTP - Used by POP and IMAP client's to send email messages.\\r\\n\\t* Autodiscover - Used by Outlook and EAS clients to find and connect to mailboxes in Exchange Online.\\r\\n\\t* Exchange ActiveSync (EAS) - Used to connect to mailboxes in Exchange Online.\\r\\n\\t* Exchange Online PowerShell - Used to connect to Exchange Online with remote PowerShell. If you block Basic authentication for Exchange Online PowerShell, you need to use the Exchange Online PowerShell Module to connect. For instructions, see Connect to Exchange Online PowerShell using multi-factor authentication.\\r\\n\\t* Exchange Web Services (EWS) - A programming interface that's used by Outlook, Outlook for Mac, and third-party apps.\\r\\n\\t* IMAP4 - Used by IMAP email clients.\\r\\n\\t* MAPI over HTTP (MAPI/HTTP) - Used by Outlook 2010 and later.\\r\\n\\t* Offline Address Book (OAB) - A copy of address list collections that are downloaded and used by Outlook.\\r\\n\\t* Outlook Anywhere (RPC over HTTP) - Used by Outlook 2016 and earlier.\\r\\n\\t* Outlook Service - Used by the Mail and Calendar app for Windows 10.\\r\\n\\t* POP3 - Used by POP email clients.\\r\\n\\t* Reporting Web Services - Used to retrieve report data in Exchange Online.\\r\\n\\t* Other clients - Other protocols identified as utilizing legacy authentication.\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Before you can block legacy authentication in your directory, you need to first understand if your users have apps that use legacy authentication and how it affects your overall directory.\\r\\n\\t* Azure AD supports several of the most widely used authentication and authorization protocols including legacy authentication. Legacy authentication refers to protocols that use basic authentication. Typically, these protocols can't enforce any type of second factor authentication. * Examples for apps that are based on legacy authentication are:\\r\\n\\t\\t* Older Microsoft Office apps\\r\\n\\t\\t* Apps using mail protocols like POP, IMAP, and SMTP\\r\\n\\t\\t* Single factor authentication (for example, username and password) is not enough these days.\\r\\n\\t\\t* Passwords are bad as they are easy to guess and we (humans) are bad at choosing good passwords. Passwords are also vulnerable to a variety of attacks like phishing and password spray. One of the easiest things you can do to protect against password threats is to implement MFA. With MFA, even if an attacker gets in possession of a user's password, the password alone is not sufficient to successfully authenticate and access the data.\\r\\n\\r\\n\\tHow can you prevent apps using legacy authentication from accessing your tenant's resources? The recommendation is to just block them with a Conditional Access policy. If necessary, you allow only certain users and specific network locations to use apps that are based on legacy authentication.\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Account\\r\\n\\t* IP address\\r\\n\\t* Account timebrush\\r\\n\\t* IP timebrush\\r\\n\\t* Auth type\\r\\n\\t* Country/region\\r\\n\\t* Full details\\r\\n\\r\\n** References   **\\r\\n- [How to: Block legacy authentication to Azure AD with Conditional Access](https://docs.microsoft.com/azure/active-directory/conditional-access/block-legacy-authentication#:~:text=To%20give%20your%20users%20easy%20access%20to%20your,environments%20a%20common%20requirement%20to%20address%20identity%20theft)\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 9\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by UserPrincipalName, ClientAppUsed //doughnut\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"Legacy authentications, by account\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"UserPrincipalName\",               \"exportParameterName\": \"UserPrincipalName\",               \"exportDefaultValue\": \"All\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"blue\"                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": []             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 29\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by IPAddress,ClientAppUsed //doughnut\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"Legacy authentications, by IP address\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"showExportToExcel\": true,               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\"                     }                   }                 ],                 \"filter\": true               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 30\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by UserPrincipalName, bin(TimeGenerated, {TimeRange:grain})\\r\\n| order by count_\\r\\n\",               \"size\": 1,               \"title\": \"Account events over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"AADTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"CountryOrRegion\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"purple\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"CountryOrRegion\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"CountryOrRegion\"                   },                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 31 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by UserPrincipalName, bin(TimeGenerated, {TimeRange:grain})\\r\\n| order by Count\\r\\n\",               \"size\": 1,               \"title\": \"Account events over time ({AADTimebrushAccount:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"AADTimebrushAccount\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"UserPrincipalName\"                   ]                 }               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 26\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by IPAddress, bin(TimeGenerated, {TimeRange:grain})\\r\\n| order by count_\\r\\n\",               \"size\": 1,               \"title\": \"IPAddresses over time - select timebrush\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"AADTimebrushIPAddress\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"linechart\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"CountryOrRegion\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"purple\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"CountryOrRegion\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"CountryOrRegion\"                   },                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"IP Timebrush\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize Count=count() by IPAddress\\r\\n| order by Count\\r\\n\",               \"size\": 1,               \"title\": \"IP events over time ({AADTimebrushIPAddress:label})\",               \"timeContext\": {                 \"durationMs\": 0               },               \"timeContextFromParameter\": \"AADTimebrushIPAddress\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"blue\",                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"sortBy\": [                   {                     \"itemKey\": \"IPAddress\",                     \"sortOrder\": 2                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"IPAddress\",                   \"sortOrder\": 2                 }               ]             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 26 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by ClientAppUsed, UserPrincipalName //bar\",               \"size\": 0,               \"title\": \"Legacy authentications, by authentication type\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"UserPrincipalName\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"gray\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"ClientAppUsed\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"UserPrincipalName\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 32\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| summarize count() by tostring(CountryOrRegion=LocationDetails.countryOrRegion), ClientAppUsed //bar\\r\\n| order by count_\\r\\n\",               \"size\": 0,               \"title\": \"Legacy authentications, by country/region\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"CountryOrRegion\",                     \"formatter\": 5,                     \"formatOptions\": {                       \"showIcon\": true                     }                   },                   {                     \"columnMatch\": \"ClientAppUsed\",                     \"formatter\": 0,                     \"formatOptions\": {                       \"showIcon\": true,                       \"aggregation\": \"Unique\"                     }                   },                   {                     \"columnMatch\": \"count_\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 0,                       \"palette\": \"purple\",                       \"showIcon\": true,                       \"aggregation\": \"Sum\"                     }                   }                 ],                 \"hierarchySettings\": {                   \"treeType\": 1,                   \"groupBy\": [                     \"CountryOrRegion\"                   ]                 },                 \"labelSettings\": [                   {                     \"columnId\": \"CountryOrRegion\"                   },                   {                     \"columnId\": \"ClientAppUsed\"                   },                   {                     \"columnId\": \"count_\",                     \"label\": \"Count\"                   }                 ]               }             },             \"customWidth\": \"50\",             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 31\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"SigninLogs\\r\\n| where ClientAppUsed !contains \\\"Browser\\\" and ClientAppUsed !contains \\\"Mobile Apps and Desktop clients\\\" and ClientAppUsed !contains \\\"Exchange ActiveSync\\\"\\r\\n| extend mergeCountry = toupper(LocationDetails.countryOrRegion)\\r\\n| summarize  IPaddress = make_set(IPAddress), Count=count() by UserPrincipalName,  ClientAppUsed, tostring(CountryOrRegion=mergeCountry) //table\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"Legacy authentications details\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 8,                     \"formatOptions\": {                       \"palette\": \"coldHot\"                     }                   }                 ],                 \"filter\": true               },               \"sortBy\": []             },             \"conditionalVisibility\": {               \"parameterName\": \"selectedTab\",               \"comparison\": \"isEqualTo\",               \"value\": \"AADLegacy\"             },             \"name\": \"query - 33\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"AADLegacy\"       },       \"name\": \"group - AAD\"     },     {       \"type\": 12,       \"content\": {         \"version\": \"NotebookGroup/1.0\",         \"groupType\": \"editable\",         \"title\": \"Group: Vulnerable Secure Channel\",         \"items\": [           {             \"type\": 1,             \"content\": {               \"json\": \"### Vulnerable Netlogon Secure Channel Help\\r\\n\\r\\n**Protocol Risk**\\r\\n\\t* An elevation of privilege vulnerability exists when an attacker establishes a vulnerable Netlogon secure channel connection to a domain controller\\r\\n\\t* An attacker who successfully exploited the vulnerability could run a specially crafted application on a device on the network\\r\\n\\r\\n**Auditing Settings**\\r\\n\\t* Apply relevant update from CVE-2020-1472 to enable logging\\r\\n\\t* In Log Analytics/Sentinel, set log collection to include Warning and Errors from the System Event log\\r\\n\\r\\n**Mitigation Planning**\\r\\n\\t* Review All Connections with an Insecure Netlogon Secure Channel\\r\\n\\t* Enforcement Mode is scheduled to be enabled on February 9, 2021\\r\\n\\t* Prior to Enforcement Mode enablement, ensure that all Netlogon clients are upgraded\\r\\n\\t* If upgrade is not possible at this time, grant an exemption in the Group Policy: Domain controller: Allow vulnerable Netlogon secure channel connections\\r\\n\\t* To enter Enforcement Mode ahead of schedule, configure the REG_DWORD FullSecureChannelProtection in key HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\Netlogon\\\\Parameters to a value of 1\\r\\n\\r\\n**Data Filters**\\r\\n\\t* Machine\\r\\n\\t* ClientIP\\r\\n\\t* Status\\r\\n\\r\\n** References   **\\r\\n- [How to manage the changes in Netlogon secure channel connections associated with CVE-2020-1472](https://support.microsoft.com/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc)\",               \"style\": \"info\"             },             \"conditionalVisibility\": {               \"parameterName\": \"Help\",               \"comparison\": \"isEqualTo\",               \"value\": \"Yes\"             },             \"name\": \"text - 9 - Copy\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nEvent\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| summarize Count=count() by Status\\r\\n| sort by Count desc\",               \"size\": 4,               \"title\": \"Secure Channel Status - click to filter\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"exportFieldName\": \"Status\",               \"exportParameterName\": \"Status\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"tiles\",               \"tileSettings\": {                 \"showBorder\": false,                 \"titleContent\": {                   \"columnMatch\": \"Status\",                   \"formatter\": 1                 },                 \"leftContent\": {                   \"columnMatch\": \"Count\",                   \"formatter\": 12,                   \"formatOptions\": {                     \"palette\": \"auto\"                   },                   \"numberFormat\": {                     \"unit\": 17,                     \"options\": {                       \"maximumSignificantDigits\": 3,                       \"maximumFractionDigits\": 2                     }                   }                 }               }             },             \"customWidth\": \"50\",             \"name\": \"query - 4\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5828, 5829, 5830, 5831]);\\r\\nEvent\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| summarize Count=count() by bin(TimeGenerated, {TimeRange:grain}), Status\",               \"size\": 1,               \"title\": \"Secure Channel by Time - Select Time Range\",               \"timeContext\": {                 \"durationMs\": 604800000               },               \"timeContextFromParameter\": \"TimeRange\",               \"timeBrushParameterName\": \"SCTimeBrush\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"visualization\": \"timechart\"             },             \"customWidth\": \"50\",             \"name\": \"query - 8\"           },           {             \"type\": 1,             \"content\": {               \"json\": \"### Machine Accounts \\r\\n---\"             },             \"name\": \"text - 5\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5829, 5830]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" Machine \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" Domain \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" OperatingSystem \\\"\u003c/P\\\" *\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize Count=count() by Machine, Status\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"By Machine - click to filter\",               \"exportFieldName\": \"Machine\",               \"exportParameterName\": \"Machine\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"visualization\": \"table\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\"                     }                   }                 ]               },               \"sortBy\": []             },             \"customWidth\": \"30\",             \"name\": \"By Machine\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5827, 5829, 5830]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" Machine \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" Domain \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" OperatingSystem \\\"\u003c/P\\\" *\\r\\n| where Machine =~ \\\"{Machine}\\\" or \\\"{Machine}\\\" =~ \\\"All\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by DomainController=Computer, Machine, Domain, AccountType, OperatingSystem, EventID, Status\\r\\n\",               \"size\": 0,               \"title\": \"Machine Account Connections\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ]             },             \"customWidth\": \"70\",             \"name\": \"query - 0\"           },           {             \"type\": 1,             \"content\": {               \"json\": \"### Trust Accounts\\r\\n---\"             },             \"name\": \"text - 6\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5828, 5831]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustName \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustTarget \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" ClientIP \\\"\u003c/P\\\" *\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize Count=count() by ClientIP, Status\\r\\n| order by Count desc\",               \"size\": 0,               \"title\": \"By Trust Account - click to filter\",               \"exportFieldName\": \"ClientIP\",               \"exportParameterName\": \"ClientIP\",               \"exportDefaultValue\": \"All\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"gridSettings\": {                 \"formatters\": [                   {                     \"columnMatch\": \"Count\",                     \"formatter\": 4,                     \"formatOptions\": {                       \"min\": 1,                       \"palette\": \"orange\"                     }                   }                 ]               }             },             \"customWidth\": \"30\",             \"name\": \"query - 7\"           },           {             \"type\": 3,             \"content\": {               \"version\": \"KqlItem/1.0\",               \"query\": \"let scEvents = dynamic([5828, 5831]);\\r\\nEvent\\r\\n| where TimeGenerated between({SCTimeBrush:start}..({SCTimeBrush:end}+{TimeRange:grain}))\\r\\n| where EventID in (scEvents)\\r\\n| where EventLog =~ \\\"System\\\" and Source =~ \\\"NETLOGON\\\"\\r\\n| parse ParameterXml with \\\"\u003cParam\u003e\\\" AccountType \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustName \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" TrustTarget \\\"\u003c/P\\\" * \\\"\u003cParam\u003e\\\" ClientIP \\\"\u003c/P\\\" *\\r\\n| where ClientIP =~ \\\"{ClientIP}\\\" or \\\"{ClientIP}\\\" =~ \\\"All\\\"\\r\\n| extend Status = case(EventID == 5827 or EventID == 5828, \\\"Connection Denied\\\", EventID == 5829, \\\"Connection Allowed - Enforcement Mode Off\\\", EventID == 5830 or EventID == 5831, \\\"Connection Allowed - Policy\\\", \\\"Unknown\\\")\\r\\n| where Status =~ \\\"{Status}\\\" or \\\"{Status}\\\" =~ \\\"All\\\"\\r\\n| summarize FirstOccurance=min(TimeGenerated), LastOccurance=max(TimeGenerated), Count=count() by DomainController=Computer, AccountType, TrustName, TrustTarget, ClientIP, EventID, Status\",               \"size\": 0,               \"title\": \"Trust Account Connections\",               \"queryType\": 0,               \"resourceType\": \"microsoft.operationalinsights/workspaces\",               \"crossComponentResources\": [                 \"{Workspace}\"               ],               \"gridSettings\": {                 \"sortBy\": [                   {                     \"itemKey\": \"ClientIP\",                     \"sortOrder\": 1                   }                 ]               },               \"sortBy\": [                 {                   \"itemKey\": \"ClientIP\",                   \"sortOrder\": 1                 }               ]             },             \"customWidth\": \"70\",             \"name\": \"query - 0 - Copy\"           }         ]       },       \"conditionalVisibility\": {         \"parameterName\": \"selectedTab\",         \"comparison\": \"isEqualTo\",         \"value\": \"NetlogonSC\"       },       \"name\": \"NetlogonSC\"     }   ],   \"fromTemplateId\": \"sentinel-UserWorkbook\",   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      },
                      {
                          "name":  "[parameters('security - linuxwindows_id')]",
                          "properties":  {
                                             "displayName":  "security - Virtual Machine Update Status",
                                             "serializedData":  "{   \"version\": \"Notebook/1.0\",   \"items\": [     {       \"type\": 1,       \"content\": {         \"json\": \"\"       },       \"customWidth\": \"100\",       \"name\": \"text - 5\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"crossComponentResources\": [           \"value::all\"         ],         \"parameters\": [           {             \"id\": \"f8d6705a-e284-4077-8113-aae1038a6b7c\",             \"version\": \"KqlParameterItem/1.0\",             \"name\": \"Workspaces\",             \"type\": 5,             \"isRequired\": true,             \"multiSelect\": true,             \"quote\": \"'\",             \"delimiter\": \",\",             \"query\": \"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| summarize by id, name\",             \"crossComponentResources\": [               \"value::all\"             ],             \"value\": [               \"value::all\"             ],             \"typeSettings\": {               \"additionalResourceOptions\": [                 \"value::1\",                 \"value::all\"               ]             },             \"queryType\": 1,             \"resourceType\": \"microsoft.resourcegraph/resources\"           }         ],         \"style\": \"pills\",         \"queryType\": 1,         \"resourceType\": \"microsoft.resourcegraph/resources\"       },       \"name\": \"parameters - 11\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"# Azure Automation Windows and Linux Update Summary for All Subscriptions\\r\\n\\r\\nThis workbook can query multiple Log Analytics Workspaces. The Azure Automation Update Management solution needs to be linked to every Log Analytics Workspaces you wish to use it with.\"       },       \"name\": \"text - 6\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Windows Updates Needed by Classification\"       },       \"customWidth\": \"50\",       \"name\": \"text - 7\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Linux Updates Needed by Classification\"       },       \"customWidth\": \"50\",       \"name\": \"text - 8\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(24h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false\\r\\n| summarize UpdatesNeeded=count(Classification) by Classification\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"tileSettings\": {           \"showBorder\": false,           \"titleContent\": {             \"columnMatch\": \"Classification\",             \"formatter\": 1           },           \"leftContent\": {             \"columnMatch\": \"UpdatesNeeded\",             \"formatter\": 12,             \"formatOptions\": {               \"palette\": \"auto\"             },             \"numberFormat\": {               \"unit\": 17,               \"options\": {                 \"maximumSignificantDigits\": 3,                 \"maximumFractionDigits\": 2               }             }           }         },         \"chartSettings\": {           \"seriesLabelSettings\": [             {               \"seriesName\": \"Security Updates\",               \"color\": \"redBright\"             },             {               \"seriesName\": \"Updates\",               \"color\": \"orange\"             },             {               \"seriesName\": \"Definition Updates\",               \"color\": \"yellow\"             },             {               \"seriesName\": \"Update Rollups\",               \"color\": \"purple\"             },             {               \"seriesName\": \"Critical Updates\",               \"color\": \"red\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"query - 0\",       \"styleSettings\": {         \"maxWidth\": \"50\"       }     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| summarize by Product, ProductArch, Classification, Computer\\r\\n| summarize count(Classification) by Classification\",         \"size\": 2,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"piechart\",         \"chartSettings\": {           \"seriesLabelSettings\": [             {               \"seriesName\": \"Others\",               \"color\": \"purple\"             },             {               \"seriesName\": \"Security Updates\",               \"color\": \"redBright\"             }           ]         }       },       \"customWidth\": \"50\",       \"name\": \"top five Computers Needing Updates\",       \"styleSettings\": {         \"maxWidth\": \"50\"       }     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Heatmap of Update Summary by Computer\\r\\n\\r\\nThis section is dynamic, by selecting a row that row's Computer name will be exported to populate Updates needed by Server\"       },       \"name\": \"text - 9\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType==\\\"Linux\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions, Computer, ResourceId, ComputerEnvironment, VMUUID) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\"\\r\\n| extend vmuuId=VMUUID, azureResourceId=ResourceId, osType=1, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), scopedToUpdatesSolution=true, lastUpdateAgentSeenTime=\\\"\\\"\\r\\n| join kind=leftouter\\r\\n(\\r\\n    Update\\r\\n    | where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\" and SourceComputerId in ((Heartbeat\\r\\n    | where TimeGenerated\u003eago(12h) and OSType==\\\"Linux\\\" and notempty(Computer)\\r\\n    | summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n    | where Solutions has \\\"updates\\\"\\r\\n    | distinct SourceComputerId))\\r\\n    | summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, Product, Computer, ComputerEnvironment) by SourceComputerId, Product, ProductArch\\r\\n    | summarize Computer=any(Computer), ComputerEnvironment=any(ComputerEnvironment), missingCriticalUpdatesCount=countif(Classification has \\\"Critical\\\" and UpdateState=~\\\"Needed\\\"), missingSecurityUpdatesCount=countif(Classification has \\\"Security\\\" and UpdateState=~\\\"Needed\\\"), missingOtherUpdatesCount=countif(Classification !has \\\"Critical\\\" and Classification !has \\\"Security\\\" and UpdateState=~\\\"Needed\\\"), lastAssessedTime=max(TimeGenerated), lastUpdateAgentSeenTime=\\\"\\\" by SourceComputerId\\r\\n    | extend compliance=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0, 2, 1)\\r\\n    | extend ComplianceOrder=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0 or missingOtherUpdatesCount \u003e 0, 1, 3)\\r\\n)\\r\\non SourceComputerId\\r\\n| project id=SourceComputerId, displayName=Computer, sourceComputerId=SourceComputerId, scopedToUpdatesSolution=true, missingCriticalUpdatesCount=coalesce(missingCriticalUpdatesCount, -1), missingSecurityUpdatesCount=coalesce(missingSecurityUpdatesCount, -1), missingOtherUpdatesCount=coalesce(missingOtherUpdatesCount, -1), compliance=coalesce(compliance, 4), lastAssessedTime, lastUpdateAgentSeenTime, osType=1, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), ComplianceOrder=coalesce(ComplianceOrder, 2)\\r\\n| union(Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions, Computer, ResourceId, ComputerEnvironment, VMUUID) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\"\\r\\n| extend vmuuId=VMUUID, azureResourceId=ResourceId, osType=2, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), scopedToUpdatesSolution=true, lastUpdateAgentSeenTime=\\\"\\\"\\r\\n| join kind=leftouter\\r\\n(\\r\\n    Update\\r\\n    | where TimeGenerated\u003eago(24h) and OSType!=\\\"Linux\\\" and SourceComputerId in ((Heartbeat\\r\\n    | where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n    | summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n    | where Solutions has \\\"updates\\\"\\r\\n    | distinct SourceComputerId))\\r\\n    | summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, Title, Optional, Approved, Computer, ComputerEnvironment) by Computer, SourceComputerId, UpdateID\\r\\n    | summarize Computer=any(Computer), ComputerEnvironment=any(ComputerEnvironment), missingCriticalUpdatesCount=countif(Classification has \\\"Critical\\\" and UpdateState=~\\\"Needed\\\" and Approved!=false), missingSecurityUpdatesCount=countif(Classification has \\\"Security\\\" and UpdateState=~\\\"Needed\\\" and Approved!=false), missingOtherUpdatesCount=countif(Classification !has \\\"Critical\\\" and Classification !has \\\"Security\\\" and UpdateState=~\\\"Needed\\\" and Optional==false and Approved!=false), lastAssessedTime=max(TimeGenerated), lastUpdateAgentSeenTime=\\\"\\\" by SourceComputerId\\r\\n    | extend compliance=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0, 2, 1)\\r\\n    | extend ComplianceOrder=iff(missingCriticalUpdatesCount \u003e 0 or missingSecurityUpdatesCount \u003e 0 or missingOtherUpdatesCount \u003e 0, 1, 3)\\r\\n)\\r\\non SourceComputerId\\r\\n| project id=SourceComputerId, displayName=Computer, sourceComputerId=SourceComputerId, scopedToUpdatesSolution=true, missingCriticalUpdatesCount=coalesce(missingCriticalUpdatesCount, -1), missingSecurityUpdatesCount=coalesce(missingSecurityUpdatesCount, -1), missingOtherUpdatesCount=coalesce(missingOtherUpdatesCount, -1), compliance=coalesce(compliance, 4), lastAssessedTime, lastUpdateAgentSeenTime, osType=2, environment=iff(ComputerEnvironment=~\\\"Azure\\\", 1, 2), ComplianceOrder=coalesce(ComplianceOrder, 2) )\\r\\n| order by ComplianceOrder asc, missingCriticalUpdatesCount desc, missingSecurityUpdatesCount desc, missingOtherUpdatesCount desc, displayName asc\\r\\n| project displayName, scopedToUpdatesSolution, CriticalUpdates=missingCriticalUpdatesCount, SecurityUpdates=missingSecurityUpdatesCount, OtherUpdates=missingOtherUpdatesCount, compliance, osType, Environment=environment, lastAssessedTime, lastUpdateAgentSeenTime\\r\\n| extend osType = replace(@\\\"2\\\", @\\\"Windows\\\", tostring(osType))\\r\\n| extend osType = replace(@\\\"1\\\", @\\\"Linux\\\", tostring(osType))\\r\\n| extend Environment = replace(@\\\"2\\\", @\\\"Non-Azure\\\", tostring(Environment))\\r\\n| extend Environment = replace(@\\\"1\\\", @\\\"Azure\\\", tostring(Environment))\",         \"size\": 0,         \"exportFieldName\": \"displayName\",         \"exportParameterName\": \"Computer\",         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"visualization\": \"table\",         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"scopedToUpdatesSolution\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"CriticalUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 1,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"SecurityUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"OtherUpdates\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 0,                 \"max\": 5,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"compliance\",               \"formatter\": 8,               \"formatOptions\": {                 \"min\": 1,                 \"max\": 2,                 \"palette\": \"greenRed\",                 \"showIcon\": true               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Environment\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastAssessedTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"lastUpdateAgentSeenTime\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         }       },       \"name\": \"query - 2\"     },     {       \"type\": 1,       \"content\": {         \"json\": \"## Updates Needed by {Computer}\"       },       \"name\": \"text - 10\"     },     {       \"type\": 9,       \"content\": {         \"version\": \"KqlParameterItem/1.0\",         \"parameters\": [],         \"style\": \"pills\",         \"queryType\": 0,         \"resourceType\": \"microsoft.insights/components\"       },       \"name\": \"parameters - 3\"     },     {       \"type\": 3,       \"content\": {         \"version\": \"KqlItem/1.0\",         \"query\": \"Update\\r\\n| where TimeGenerated\u003eago(24h) and OSType!=\\\"Linux\\\" and (Optional==false or Classification has \\\"Critical\\\" or Classification has \\\"Security\\\") and SourceComputerId in ((Heartbeat\\r\\n| where TimeGenerated\u003eago(12h) and OSType=~\\\"Windows\\\" and notempty(Computer)\\r\\n| summarize arg_max(TimeGenerated, Solutions) by SourceComputerId\\r\\n| where Solutions has \\\"updates\\\" | distinct SourceComputerId))\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\\r\\n| where UpdateState=~\\\"Needed\\\" and Approved!=false and Computer=='{Computer}'\\r\\n| project Computer, Title, Classification, PublishedDate, UpdateState, Product\\r\\n| union( Update\\r\\n| where TimeGenerated\u003eago(5h) and OSType==\\\"Linux\\\" and Computer == \\\"{Computer}\\\"\\r\\n| summarize hint.strategy=partitioned arg_max(TimeGenerated, UpdateState, Classification, BulletinUrl, BulletinID) by Computer, SourceComputerId, Product, ProductArch\\r\\n| where UpdateState=~\\\"Needed\\\"\\r\\n| project-away UpdateState, TimeGenerated\\r\\n| summarize computersCount=dcount(SourceComputerId, 2), ClassificationWeight=max(iff(Classification has \\\"Critical\\\", 4, iff(Classification has \\\"Security\\\", 2, 1))) by Computer, id=strcat(Product, \\\"_\\\", ProductArch), displayName=Product, productArch=ProductArch, classification=Classification, InformationId=BulletinID, InformationUrl=tostring(split(BulletinUrl, \\\";\\\", 0)[0]), osType=1\\r\\n| sort by ClassificationWeight desc, computersCount desc, displayName asc\\r\\n| extend informationLink=(iff(isnotempty(InformationId) and isnotempty(InformationUrl), toobject(strcat('{ \\\"uri\\\": \\\"', InformationUrl, '\\\", \\\"text\\\": \\\"', InformationId, '\\\", \\\"target\\\": \\\"blank\\\" }')), toobject('')))\\r\\n| project-away ClassificationWeight, InformationId, InformationUrl)\\r\\n\",         \"size\": 0,         \"queryType\": 0,         \"resourceType\": \"microsoft.operationalinsights/workspaces\",         \"crossComponentResources\": [           \"{Workspaces}\"         ],         \"gridSettings\": {           \"formatters\": [             {               \"columnMatch\": \"Computer\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Title\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Classification\",               \"formatter\": 18,               \"formatOptions\": {                 \"palette\": \"greenRed\",                 \"showIcon\": true,                 \"thresholdsOptions\": \"colors\",                 \"thresholdsGrid\": [                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Critical Updates\",                     \"representation\": \"redDark\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Security Updates\",                     \"representation\": \"redBright\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Definition Updates\",                     \"representation\": \"yellow\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Update Rollups\",                     \"representation\": \"purple\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"==\",                     \"thresholdValue\": \"Updates\",                     \"representation\": \"orange\",                     \"text\": \"{0}{1}\"                   },                   {                     \"operator\": \"Default\",                     \"thresholdValue\": null,                     \"representation\": \"blue\",                     \"text\": \"{0}{1}\"                   }                 ]               }             },             {               \"columnMatch\": \"PublishedDate\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"UpdateState\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"Product\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"id\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"displayName\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"productArch\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"classification\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"osType\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"computersCount\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             },             {               \"columnMatch\": \"informationLink\",               \"formatter\": 0,               \"formatOptions\": {                 \"showIcon\": true               }             }           ]         },         \"sortBy\": []       },       \"name\": \"query - 4\"     }   ],   \"$schema\": \"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\" }",
                                             "category":  "workbook",
                                             "version":  "1.0",
                                             "sourceId":  "[resourceid('Microsoft.OperationalInsights/workspaces',parameters('workspacename'))]"
                                         },
                          "type":  "microsoft.insights/workbooks",
                          "kind":  "shared",
                          "apiVersion":  "2018-06-17-preview",
                          "location":  "[parameters('location')]"
                      }
                  ]
}
